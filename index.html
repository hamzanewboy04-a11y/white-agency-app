<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>White Agency ‚Äî –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        :root {
            --tg-theme-bg-color: #ffffff;
            --tg-theme-text-color: #000000;
            --tg-theme-hint-color: #999999;
            --tg-theme-link-color: #2481cc;
            --tg-theme-button-color: #000000;
            --tg-theme-button-text-color: #ffffff;
            --tg-theme-secondary-bg-color: #f5f5f5;
        }
        
        body {
            background: var(--tg-theme-bg-color);
            color: var(--tg-theme-text-color);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        body.dark {
            --tg-theme-bg-color: #1a1a1a;
            --tg-theme-text-color: #ffffff;
            --tg-theme-hint-color: #999999;
            --tg-theme-link-color: #64b5f6;
            --tg-theme-button-color: #ffffff;
            --tg-theme-button-text-color: #000000;
            --tg-theme-secondary-bg-color: #2a2a2a;
        }

        /* Dark theme improvements */
        body.dark .card {
            border: 1px solid rgba(255,255,255,0.1);
        }

        body.dark input,
        body.dark textarea,
        body.dark select {
            background: #2a2a2a;
            color: #ffffff;
            border: 1px solid rgba(255,255,255,0.2);
        }

        body.dark input::placeholder,
        body.dark textarea::placeholder {
            color: #888888;
        }

        body.dark .text-gray-700 {
            color: #e0e0e0;
        }

        body.dark .text-gray-500 {
            color: #aaaaaa;
        }

        body.dark .text-gray-400 {
            color: #999999;
        }

        body.dark .border-gray-100 {
            border-color: rgba(255,255,255,0.1);
        }

        body.dark .bg-gray-100 {
            background-color: #2a2a2a;
        }

        body.dark .hover\:bg-gray-100:hover {
            background-color: #3a3a3a;
        }
        
        .card {
            backdrop-filter: blur(10px);
            background: var(--tg-theme-secondary-bg-color);
            border: 1px solid rgba(128,128,128,0.1);
        }
        
        .tab-active {
            background: var(--tg-theme-button-color);
            color: var(--tg-theme-button-text-color);
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .slide-up {
            animation: slideUp 0.4s ease-out;
        }
        
        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }
        
        input, textarea, select {
            font-size: 16px !important;
            background: var(--tg-theme-secondary-bg-color);
            color: var(--tg-theme-text-color);
        }
        
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        
        .badge-platinum { background: linear-gradient(135deg, #E5E4E2 0%, #A0A0A0 50%, #E5E4E2 100%); }
        .badge-gold { background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%); }
        .badge-silver { background: linear-gradient(135deg, #C0C0C0 0%, #A0A0A0 100%); }
        .badge-bronze { background: linear-gradient(135deg, #CD7F32 0%, #8B4513 100%); }
        
        .level-bronze { border-color: #CD7F32; }
        .level-silver { border-color: #C0C0C0; }
        .level-gold { border-color: #FFD700; }
        .level-platinum { border-color: #E5E4E2; }
        
        .btn-primary {
            background: var(--tg-theme-button-color);
            color: var(--tg-theme-button-text-color);
        }
        
        .cashback-glow {
            box-shadow: 0 0 20px rgba(34, 197, 94, 0.2);
        }
        
        .loading {
            pointer-events: none;
            opacity: 0.7;
        }
        
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: skeleton 1.5s infinite;
        }
        
        @keyframes skeleton {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        body.dark .skeleton {
            background: linear-gradient(90deg, #2a2a2a 25%, #3a3a3a 50%, #2a2a2a 75%);
            background-size: 200% 100%;
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen" class="fixed inset-0 z-[200] flex items-center justify-center" style="background: var(--tg-theme-bg-color);">
        <div class="text-center">
            <div class="w-16 h-16 border-4 border-gray-200 border-t-black rounded-full animate-spin mx-auto mb-4"></div>
            <p class="text-gray-500">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
        </div>
    </div>

    <!-- Header -->
    <header class="sticky top-0 z-50 backdrop-blur-lg border-b border-gray-100 px-4 py-3" style="background: var(--tg-theme-bg-color);">
        <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="relative">
                    <div class="w-11 h-11 rounded-full bg-gradient-to-br from-gray-800 to-black flex items-center justify-center text-white font-bold text-lg border-2" id="avatarPreview">
                        ?
                    </div>
                    <div class="absolute -bottom-0.5 -right-0.5 w-4 h-4 bg-green-500 rounded-full border-2 border-white"></div>
                </div>
                <div>
                    <h1 class="font-semibold text-base" id="userName">–ó–∞–≥—Ä—É–∑–∫–∞...</h1>
                    <div class="flex items-center gap-1.5">
                        <span class="text-xs px-2 py-0.5 rounded-full badge-bronze text-white font-medium" id="userLevelBadge">Bronze</span>
                        <span class="text-xs text-gray-500" id="userDiscount">—Å–∫–∏–¥–∫–∞ 5%</span>
                    </div>
                </div>
            </div>
            <div class="flex items-center gap-2">
                <button onclick="showNotifications()" class="relative w-10 h-10 flex items-center justify-center rounded-full hover:bg-gray-100 transition-colors">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
                    </svg>
                    <span class="absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full" id="notifDot"></span>
                </button>
                <button onclick="showSettings()" class="w-10 h-10 flex items-center justify-center rounded-full hover:bg-gray-100 transition-colors">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                </button>
            </div>
        </div>
    </header>

    <!-- Balance Cards -->
    <section class="px-4 py-4">
        <div class="grid grid-cols-2 gap-3">
            <!-- Cashback Card -->
            <div class="card rounded-2xl p-4 relative overflow-hidden cashback-glow">
                <div class="absolute top-0 right-0 w-20 h-20 bg-gradient-to-br from-green-400/20 to-transparent rounded-full -translate-y-1/2 translate-x-1/2"></div>
                <div class="text-xs text-gray-500 mb-1">üíµ –ö–µ—à–±—ç–∫</div>
                <div class="text-2xl font-bold text-green-600" id="cashbackBalance">$0.00</div>
                <div class="text-xs text-gray-400 mt-1">–î–æ—Å—Ç—É–ø–Ω–æ –∫ –æ–ø–ª–∞—Ç–µ</div>
                <button onclick="showCashbackHistory()" class="mt-2 text-xs text-gray-600 underline">–ò—Å—Ç–æ—Ä–∏—è</button>
            </div>
            
            <!-- Referral Card -->
            <div class="card rounded-2xl p-4 relative overflow-hidden">
                <div class="absolute top-0 right-0 w-20 h-20 bg-gradient-to-br from-blue-400/20 to-transparent rounded-full -translate-y-1/2 translate-x-1/2"></div>
                <div class="text-xs text-gray-500 mb-1">üë• –†–µ—Ñ–µ—Ä–∞–ª—ã</div>
                <div class="text-2xl font-bold" id="referralCount">0</div>
                <div class="text-xs text-green-600 mt-1 font-medium" id="referralEarnings">+$0 –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ</div>
                <button onclick="showReferral()" class="mt-2 text-xs text-gray-600 underline">–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å</button>
            </div>
        </div>
        
        <!-- Level Progress -->
        <div class="card rounded-2xl p-4 mt-3">
            <div class="flex justify-between items-center mb-2">
                <div class="flex items-center gap-2">
                    <span class="text-sm font-medium" id="nextLevelText">–î–æ Silver</span>
                    <span class="text-xs px-2 py-0.5 rounded-full bg-gray-100" id="nextLevelDiscount">—Å–∫–∏–¥–∫–∞ 10%</span>
                </div>
                <span class="text-sm text-gray-500" id="progressText">$0 / $500</span>
            </div>
            <div class="h-2.5 bg-gray-100 rounded-full overflow-hidden">
                <div class="h-full bg-gradient-to-r from-gray-800 to-black rounded-full transition-all duration-500" id="progressBar" style="width: 0%"></div>
            </div>
            <div class="flex justify-between mt-3 text-xs">
                <div class="flex items-center gap-1">
                    <span class="w-2 h-2 rounded-full badge-bronze"></span>
                    <span class="text-gray-400">$100</span>
                </div>
                <div class="flex items-center gap-1">
                    <span class="w-2 h-2 rounded-full badge-silver"></span>
                    <span class="text-gray-400">$500</span>
                </div>
                <div class="flex items-center gap-1">
                    <span class="w-2 h-2 rounded-full badge-gold"></span>
                    <span class="text-gray-400">$1,000</span>
                </div>
                <div class="flex items-center gap-1">
                    <span class="w-2 h-2 rounded-full badge-platinum"></span>
                    <span class="text-gray-400">$10,000</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Quick Actions -->
    <section class="px-4 pb-4">
        <div class="grid grid-cols-4 gap-2">
            <button onclick="showOrderForm()" class="flex flex-col items-center gap-1.5 p-3 rounded-2xl btn-primary hover:opacity-90 transition-opacity">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                </svg>
                <span class="text-xs font-medium">–ó–∞–∫–∞–∑</span>
            </button>
            <button onclick="showPrices()" class="flex flex-col items-center gap-1.5 p-3 rounded-2xl bg-gray-100 hover:bg-gray-200 transition-colors">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                </svg>
                <span class="text-xs font-medium">–¶–µ–Ω—ã</span>
            </button>
            <button onclick="showGallery()" class="flex flex-col items-center gap-1.5 p-3 rounded-2xl bg-gray-100 hover:bg-gray-200 transition-colors">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                </svg>
                <span class="text-xs font-medium">–†–∞–±–æ—Ç—ã</span>
            </button>
            <button onclick="showChat()" class="flex flex-col items-center gap-1.5 p-3 rounded-2xl bg-gray-100 hover:bg-gray-200 transition-colors relative">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                </svg>
                <span class="text-xs font-medium">–ß–∞—Ç</span>
            </button>
        </div>
    </section>

    <!-- Tabs -->
    <section class="px-4 mb-4">
        <div class="flex gap-2 overflow-x-auto scrollbar-hide pb-2">
            <button onclick="switchTab('orders')" class="tab-btn tab-active px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-all" data-tab="orders">
                –ó–∞–∫–∞–∑—ã
            </button>
            <button onclick="switchTab('promo')" class="tab-btn px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap bg-gray-100 transition-all" data-tab="promo">
                –ü—Ä–æ–º–æ–∫–æ–¥—ã
            </button>
            <button onclick="switchTab('achievements')" class="tab-btn px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap bg-gray-100 transition-all" data-tab="achievements">
                –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è
            </button>
            <button onclick="switchTab('stats')" class="tab-btn px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap bg-gray-100 transition-all" data-tab="stats">
                –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            </button>
        </div>
    </section>

    <!-- Tab Content -->
    <section class="px-4 pb-24" id="tabContent">
        <!-- Orders Tab -->
        <div id="ordersTab" class="space-y-3 fade-in">
            <div id="ordersList">
                <div class="text-center py-8 text-gray-400">
                    <svg class="w-16 h-16 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                    </svg>
                    <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤</p>
                    <button onclick="showOrderForm()" class="mt-4 px-6 py-2 btn-primary rounded-full text-sm font-medium">
                        –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—ã–π –∑–∞–∫–∞–∑
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Promo Tab -->
        <div id="promoTab" class="space-y-3 hidden fade-in">
            <div class="card rounded-2xl p-4">
                <div class="flex gap-3">
                    <input type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥" class="flex-1 px-4 py-3 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-black" id="promoInput">
                    <button onclick="applyPromo()" class="px-5 py-3 btn-primary rounded-xl text-sm font-medium">
                        OK
                    </button>
                </div>
            </div>
            
            <div class="card rounded-2xl p-4 border border-dashed border-gray-300">
                <div class="flex items-center justify-between">
                    <div>
                        <span class="text-xs text-gray-500">–í–∞—à –ø—Ä–æ–º–æ–∫–æ–¥ –¥–ª—è –¥—Ä—É–∑–µ–π</span>
                        <p class="font-mono text-lg font-bold mt-1" id="myPromoCode">---</p>
                    </div>
                    <button onclick="copyPromo()" class="px-4 py-2 bg-gray-100 rounded-lg text-sm hover:bg-gray-200">
                        üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
                    </button>
                </div>
                <p class="text-xs text-gray-400 mt-2">–î—Ä—É–≥ –ø–æ–ª—É—á–∏—Ç -15% –Ω–∞ –ø–µ—Ä–≤—ã–π –∑–∞–∫–∞–∑, –≤—ã ‚Äî 25% –æ—Ç —Å—É–º–º—ã –µ–≥–æ –∑–∞–∫–∞–∑–∞</p>
            </div>
        </div>
        
        <!-- Achievements Tab -->
        <div id="achievementsTab" class="space-y-3 hidden fade-in">
            <div class="grid grid-cols-3 gap-3" id="achievementsList">
            </div>
        </div>
        
        <!-- Stats Tab -->
        <div id="statsTab" class="space-y-3 hidden fade-in">
            <div class="card rounded-2xl p-4">
                <h3 class="font-semibold mb-4">–í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                <div class="space-y-3" id="statsContent">
                </div>
            </div>
        </div>
    </section>

    <!-- Bottom Navigation -->
    <nav class="fixed bottom-0 left-0 right-0 backdrop-blur-lg border-t border-gray-100 px-6 py-2 pb-6" style="background: var(--tg-theme-bg-color);">
        <div class="flex justify-around items-center">
            <button class="flex flex-col items-center gap-0.5" style="color: var(--tg-theme-button-color);">
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
                </svg>
                <span class="text-[10px] font-medium">–ì–ª–∞–≤–Ω–∞—è</span>
            </button>
            <button onclick="showOrderForm()" class="flex flex-col items-center gap-0.5 text-gray-400">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                </svg>
                <span class="text-[10px] font-medium">–ó–∞–∫–∞–∑–∞—Ç—å</span>
            </button>
            <button onclick="showReferral()" class="flex flex-col items-center gap-0.5 text-gray-400">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
                </svg>
                <span class="text-[10px] font-medium">–†–µ—Ñ–µ—Ä–∞–ª—ã</span>
            </button>
            <button onclick="showSettings()" class="flex flex-col items-center gap-0.5 text-gray-400">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                </svg>
                <span class="text-[10px] font-medium">–ü—Ä–æ—Ñ–∏–ª—å</span>
            </button>
        </div>
    </nav>

    <!-- Modal Overlay -->
    <div id="modalOverlay" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden" onclick="closeModal()"></div>

    <!-- Order Form Modal -->
    <div id="orderModal" class="fixed bottom-0 left-0 right-0 rounded-t-3xl z-50 hidden max-h-[90vh] overflow-y-auto" style="background: var(--tg-theme-bg-color);">
        <div class="sticky top-0 pt-4 px-6 pb-2 border-b" style="background: var(--tg-theme-bg-color);">
            <div class="w-12 h-1 bg-gray-300 rounded-full mx-auto mb-4"></div>
            <h2 class="text-xl font-bold">–ù–æ–≤—ã–π –∑–∞–∫–∞–∑</h2>
        </div>
        <div class="p-6 space-y-4">
            <div>
                <label class="text-sm font-medium text-gray-700 mb-2 block">–¢–∏–ø —É—Å–ª—É–≥–∏</label>
                <select id="serviceType" onchange="updatePrice()" class="w-full px-4 py-3 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-black">
                    <option value="10">–°—Ç–∞—Ç–∏–∫–∞ (–æ—Ç $10)</option>
                    <option value="30">–ü–∞–∫ —Å—Ç–∞—Ç–∏–∫–∏ 5 —à—Ç (–æ—Ç $30)</option>
                    <option value="25">–í–∏–¥–µ–æ-–∫—Ä–µ–∞—Ç–∏–≤ (–æ—Ç $25)</option>
                    <option value="40">–õ–∏–ø—Å–∏–Ω–≥ (–æ—Ç $40)</option>
                    <option value="30">AI-–∞–≤–∞—Ç–∞—Ä (–æ—Ç $30)</option>
                    <option value="100">UGC-–≤–∏–¥–µ–æ (–æ—Ç $100)</option>
                    <option value="15">GIF/–ê–Ω–∏–º–∞—Ü–∏—è (–æ—Ç $15)</option>
                    <option value="200">–î–∏–∑–∞–π–Ω –ª–µ–Ω–¥–∏–Ω–≥–∞ (–æ—Ç $200)</option>
                </select>
            </div>
            <div>
                <label class="text-sm font-medium text-gray-700 mb-2 block">–ù–∏—à–∞</label>
                <select id="nicheType" class="w-full px-4 py-3 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-black">
                    <option>Gambling / Betting</option>
                    <option>Crypto / Forex</option>
                    <option>–¢–æ–≤–∞—Ä–∫–∞</option>
                    <option>–í–∞–∫–∞–Ω—Å–∏–∏ / –õ–∏–¥–≥–µ–Ω</option>
                    <option>–î—Ä—É–≥–æ–µ</option>
                </select>
            </div>
            <div>
                <label class="text-sm font-medium text-gray-700 mb-2 block">–§–æ—Ä–º–∞—Ç / –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞</label>
                <div class="flex flex-wrap gap-2" id="formatButtons">
                    <button type="button" class="format-btn px-3 py-2 rounded-lg bg-gray-100 text-sm" onclick="toggleFormat(this)">FB/Insta</button>
                    <button type="button" class="format-btn px-3 py-2 rounded-lg bg-gray-100 text-sm" onclick="toggleFormat(this)">TikTok</button>
                    <button type="button" class="format-btn px-3 py-2 rounded-lg bg-gray-100 text-sm" onclick="toggleFormat(this)">Telegram</button>
                    <button type="button" class="format-btn px-3 py-2 rounded-lg bg-gray-100 text-sm" onclick="toggleFormat(this)">9:16</button>
                    <button type="button" class="format-btn px-3 py-2 rounded-lg bg-gray-100 text-sm" onclick="toggleFormat(this)">1:1</button>
                    <button type="button" class="format-btn px-3 py-2 rounded-lg bg-gray-100 text-sm" onclick="toggleFormat(this)">4:5</button>
                </div>
            </div>
            <div>
                <label class="text-sm font-medium text-gray-700 mb-2 block">–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏</label>
                <textarea id="orderDescription" class="w-full px-4 py-3 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-black h-24 resize-none" placeholder="–û–ø–∏—à–∏—Ç–µ, —á—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å..."></textarea>
            </div>
            <div>
                <label class="text-sm font-medium text-gray-700 mb-2 block">–†–µ—Ñ–µ—Ä–µ–Ω—Å—ã (—Å—Å—ã–ª–∫–∏)</label>
                <input type="text" id="orderRefs" class="w-full px-4 py-3 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-black" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ –ø—Ä–∏–º–µ—Ä">
            </div>
            <div>
                <label class="text-sm font-medium text-gray-700 mb-2 block">–ú–µ–¥–∏–∞-—Ñ–∞–π–ª—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                <input type="file" id="orderMediaFiles" multiple accept="image/*,video/*,.pdf,.zip,.rar"
                    onchange="handleFileSelect(this)"
                    class="w-full px-4 py-3 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-black bg-gray-50 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-medium file:bg-black file:text-white hover:file:bg-gray-800">
                <div class="text-xs text-gray-500 mt-1">–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ, –≤–∏–¥–µ–æ –∏–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã (–º–∞–∫—Å 10MB –∫–∞–∂–¥—ã–π)</div>
                <div id="filePreview" class="mt-3 grid grid-cols-3 gap-2"></div>
            </div>

            <!-- Order Summary -->
            <div class="card rounded-xl p-4 space-y-3">
                <div class="flex justify-between items-center">
                    <span class="text-sm">–°—Ç–æ–∏–º–æ—Å—Ç—å</span>
                    <span class="font-bold" id="orderPrice">$10.00</span>
                </div>
                <div class="flex justify-between items-center text-green-600">
                    <span class="text-sm">–°–∫–∏–¥–∫–∞ <span id="discountLevel">Bronze</span> (-<span id="discountPercent">5</span>%)</span>
                    <span class="font-medium" id="orderDiscount">-$0.50</span>
                </div>
                <div class="flex justify-between items-center">
                    <div class="flex items-center gap-2">
                        <span class="text-sm">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–µ—à–±—ç–∫</span>
                        <span class="text-xs text-gray-400">(–º–∞–∫—Å 50%)</span>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" class="sr-only peer" id="useCashback" onchange="updatePrice()">
                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-500"></div>
                    </label>
                </div>
                <div id="cashbackApplied" class="hidden flex justify-between items-center text-green-600">
                    <span class="text-sm">–ö–µ—à–±—ç–∫ —Å–ø–∏—Å–∞–Ω</span>
                    <span class="font-medium" id="cashbackAmount">-$0.00</span>
                </div>
                <div class="border-t pt-3 flex justify-between items-center">
                    <span class="font-semibold">–ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ</span>
                    <span class="text-xl font-bold" id="orderTotal">$9.50</span>
                </div>
                <div class="flex justify-between items-center text-green-600 text-sm">
                    <span>–ö–µ—à–±—ç–∫ –∑–∞ –∑–∞–∫–∞–∑ (5%)</span>
                    <span class="font-medium" id="orderCashback">+$0.48</span>
                </div>
            </div>
            
            <button onclick="proceedToPayment()" id="submitOrderBtn" class="w-full py-4 btn-primary rounded-xl font-semibold transition-opacity">
                –ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø–ª–∞—Ç–µ ‚Üí
            </button>
        </div>
    </div>

    <!-- Tips Modal -->
    <div id="tipsModal" class="fixed bottom-0 left-0 right-0 rounded-t-3xl z-50 hidden" style="background: var(--tg-theme-bg-color);">
        <div class="p-6">
            <div class="w-12 h-1 bg-gray-300 rounded-full mx-auto mb-4"></div>
            <h2 class="text-xl font-bold text-center mb-2">üíù –ß–∞–µ–≤—ã–µ –¥–∏–∑–∞–π–Ω–µ—Ä—É</h2>
            <p class="text-sm text-gray-500 text-center mb-6">100% —Å—É–º–º—ã –ø–æ–ª—É—á–∏—Ç –¥–∏–∑–∞–π–Ω–µ—Ä –Ω–∞ TRC-20</p>
            
            <div class="grid grid-cols-4 gap-3 mb-4">
                <button onclick="selectTip(5)" class="tip-btn py-3 rounded-xl bg-gray-100 font-bold hover:bg-gray-200 transition-colors">$5</button>
                <button onclick="selectTip(10)" class="tip-btn py-3 rounded-xl bg-gray-100 font-bold hover:bg-gray-200 transition-colors">$10</button>
                <button onclick="selectTip(20)" class="tip-btn py-3 rounded-xl bg-gray-100 font-bold hover:bg-gray-200 transition-colors">$20</button>
                <button onclick="selectTip(50)" class="tip-btn py-3 rounded-xl bg-gray-100 font-bold hover:bg-gray-200 transition-colors">$50</button>
            </div>
            
            <input type="number" id="customTip" placeholder="–°–≤–æ—è —Å—É–º–º–∞ $" class="w-full px-4 py-3 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-black mb-4">
            
            <textarea id="tipMessage" class="w-full px-4 py-3 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-black h-20 resize-none mb-4" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ –¥–∏–∑–∞–π–Ω–µ—Ä—É (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"></textarea>
            
            <button onclick="sendTip()" class="w-full py-4 bg-green-600 text-white rounded-xl font-semibold hover:bg-green-700 transition-colors">
                –û—Ç–ø—Ä–∞–≤–∏—Ç—å —á–∞–µ–≤—ã–µ
            </button>
        </div>
    </div>

    <!-- Referral Modal -->
    <div id="referralModal" class="fixed bottom-0 left-0 right-0 rounded-t-3xl z-50 hidden max-h-[85vh] overflow-y-auto" style="background: var(--tg-theme-bg-color);">
        <div class="p-6">
            <div class="w-12 h-1 bg-gray-300 rounded-full mx-auto mb-4"></div>
            <h2 class="text-xl font-bold text-center mb-2">üë• –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞</h2>
            <p class="text-sm text-gray-500 text-center mb-6">–ü—Ä–∏–≥–ª–∞—à–∞–π –¥—Ä—É–∑–µ–π –∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π</p>
            
            <div class="card rounded-2xl p-4 bg-gradient-to-r from-green-600 to-green-500 text-white mb-4">
                <div class="text-center mb-3">
                    <p class="text-4xl font-bold">25%</p>
                    <p class="text-sm opacity-90">—Å –ø–µ—Ä–≤–æ–≥–æ –∑–∞–∫–∞–∑–∞ –∫–∞–∂–¥–æ–≥–æ –¥—Ä—É–≥–∞</p>
                </div>
                <p class="text-xs opacity-80 text-center">–ë–µ—Å—Å—Ä–æ—á–Ω–æ –∏ –±–µ–∑ –ª–∏–º–∏—Ç–æ–≤!</p>
            </div>
            
            <div class="card rounded-2xl p-4 bg-gray-900 text-white mb-4">
                <p class="text-sm opacity-80 mb-2">–í–∞—à–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞</p>
                <div class="flex gap-2">
                    <input type="text" readonly id="refLinkInput" value="" class="flex-1 bg-white/10 px-3 py-2 rounded-lg text-sm font-mono">
                    <button onclick="copyRefLink()" class="px-4 py-2 bg-white text-black rounded-lg text-sm font-medium hover:bg-gray-100">üìã</button>
                </div>
            </div>
            
            <div class="grid grid-cols-2 gap-3 mb-6">
                <div class="card rounded-xl p-4 text-center">
                    <p class="text-3xl font-bold" id="refCountModal">0</p>
                    <p class="text-xs text-gray-500">–ü—Ä–∏–≥–ª–∞—à–µ–Ω–æ</p>
                </div>
                <div class="card rounded-xl p-4 text-center">
                    <p class="text-3xl font-bold text-green-600" id="refEarningsModal">$0</p>
                    <p class="text-xs text-gray-500">–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ</p>
                </div>
            </div>
            
            <div class="card rounded-xl p-4 mb-4">
                <h3 class="font-semibold mb-3">–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?</h3>
                <div class="space-y-3 text-sm">
                    <div class="flex gap-3">
                        <span class="w-6 h-6 rounded-full bg-black text-white flex items-center justify-center text-xs flex-shrink-0">1</span>
                        <p>–ü–æ–¥–µ–ª–∏—Å—å —Å—Å—ã–ª–∫–æ–π —Å –¥—Ä—É–≥–æ–º</p>
                    </div>
                    <div class="flex gap-3">
                        <span class="w-6 h-6 rounded-full bg-black text-white flex items-center justify-center text-xs flex-shrink-0">2</span>
                        <p>–î—Ä—É–≥ –ø–æ–ª—É—á–∞–µ—Ç <strong>-15%</strong> –Ω–∞ –ø–µ—Ä–≤—ã–π –∑–∞–∫–∞–∑</p>
                    </div>
                    <div class="flex gap-3">
                        <span class="w-6 h-6 rounded-full bg-green-500 text-white flex items-center justify-center text-xs flex-shrink-0">$</span>
                        <p>–¢—ã –ø–æ–ª—É—á–∞–µ—à—å <strong>25%</strong> –æ—Ç –µ–≥–æ –ø–µ—Ä–≤–æ–≥–æ –∑–∞–∫–∞–∑–∞ –Ω–∞ TRC-20</p>
                    </div>
                </div>
            </div>
            
            <div id="referralsList" class="mb-4"></div>
            
            <button onclick="shareRefLink()" class="w-full py-4 btn-primary rounded-xl font-semibold transition-opacity">
                –ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å—Å—ã–ª–∫–æ–π
            </button>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="fixed bottom-0 left-0 right-0 rounded-t-3xl z-50 hidden max-h-[90vh] overflow-y-auto" style="background: var(--tg-theme-bg-color);">
        <div class="p-6">
            <div class="w-12 h-1 bg-gray-300 rounded-full mx-auto mb-4"></div>
            <h2 class="text-xl font-bold text-center mb-6">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è</h2>
            
            <div class="flex flex-col items-center mb-6">
                <div class="relative">
                    <div class="w-24 h-24 rounded-full bg-gradient-to-br from-gray-800 to-black flex items-center justify-center text-white text-3xl font-bold border-3" id="settingsAvatar">
                        ?
                    </div>
                </div>
                <p class="text-sm text-gray-500 mt-2" id="settingsUsername">@username</p>
                <div class="mt-2 px-3 py-1 rounded-full text-white text-xs font-medium" id="settingsLevelBadge">Bronze</div>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="text-sm font-medium text-gray-700 mb-2 block">–ò–º—è</label>
                    <input type="text" id="settingsName" class="w-full px-4 py-3 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-black">
                </div>
                
                <!-- TRC-20 Wallet -->
                <div class="pt-4 border-t">
                    <div class="flex items-center gap-2 mb-2">
                        <span class="text-lg">üíé</span>
                        <label class="text-sm font-medium text-gray-700">–ö–æ—à–µ–ª—ë–∫ TRC-20 (–¥–ª—è –≤—ã–ø–ª–∞—Ç)</label>
                    </div>
                    <input type="text" id="trc20Wallet" placeholder="TRC-20 –∞–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞ USDT" class="w-full px-4 py-3 rounded-xl text-sm font-mono focus:outline-none focus:ring-2 focus:ring-black">
                    <p class="text-xs text-gray-400 mt-2">–°—é–¥–∞ –±—É–¥—É—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ –≤—ã–ø–ª–∞—Ç—ã</p>
                </div>
                
                <div class="pt-4 border-t">
                    <h3 class="font-semibold mb-3">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-sm">–°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞</span>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer" id="notifOrders" checked>
                                <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-black"></div>
                            </label>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm">–ê–∫—Ü–∏–∏ –∏ —Å–∫–∏–¥–∫–∏</span>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer" id="notifPromo" checked>
                                <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-black"></div>
                            </label>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm">–†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ –≤—ã–ø–ª–∞—Ç—ã</span>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer" id="notifRef" checked>
                                <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-black"></div>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            
            <button onclick="saveSettings()" class="w-full py-4 btn-primary rounded-xl font-semibold mt-6">
                –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
            </button>
        </div>
    </div>

    <!-- Prices Modal -->
    <div id="pricesModal" class="fixed bottom-0 left-0 right-0 rounded-t-3xl z-50 hidden max-h-[90vh] overflow-y-auto" style="background: var(--tg-theme-bg-color);">
        <div class="p-6">
            <div class="w-12 h-1 bg-gray-300 rounded-full mx-auto mb-4"></div>
            <h2 class="text-xl font-bold text-center mb-2">üí∞ –¶–µ–Ω—ã –Ω–∞ —É—Å–ª—É–≥–∏</h2>
            <p class="text-sm text-gray-500 text-center mb-6">–í–∞—à–∞ —Å–∫–∏–¥–∫–∞: <span class="text-green-600 font-bold" id="priceDiscount">-5%</span></p>
            
            <div class="space-y-2" id="pricesList"></div>
            
            <div class="card rounded-xl p-4 bg-green-50 mt-4">
                <p class="text-sm text-center">+ <strong>5% –∫–µ—à–±—ç–∫</strong> —Å –∫–∞–∂–¥–æ–≥–æ –∑–∞–∫–∞–∑–∞!</p>
            </div>
        </div>
    </div>

    <!-- Gallery Modal -->
    <div id="galleryModal" class="fixed bottom-0 left-0 right-0 rounded-t-3xl z-50 hidden max-h-[90vh] overflow-y-auto" style="background: var(--tg-theme-bg-color);">
        <div class="p-6">
            <div class="w-12 h-1 bg-gray-300 rounded-full mx-auto mb-4"></div>
            <h2 class="text-xl font-bold text-center mb-6">üñºÔ∏è –í–∞—à–∏ —Ä–∞–±–æ—Ç—ã</h2>
            <div id="galleryContent" class="grid grid-cols-2 gap-3">
                <div class="text-center py-8 text-gray-400 col-span-2">
                    <p>–†–∞–±–æ—Ç—ã –ø–æ—è–≤—è—Ç—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –∑–∞–∫–∞–∑–∞</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Review Modal -->
    <div id="reviewModal" class="fixed bottom-0 left-0 right-0 rounded-t-3xl z-50 hidden" style="background: var(--tg-theme-bg-color);">
        <div class="p-6">
            <div class="w-12 h-1 bg-gray-300 rounded-full mx-auto mb-4"></div>
            <h2 class="text-xl font-bold text-center mb-2">‚≠ê –û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</h2>
            <p class="text-sm text-gray-500 text-center mb-6">–ü–æ–ª—É—á–∏—Ç–µ $2 –Ω–∞ –∫–µ—à–±—ç–∫ –∑–∞ —á–µ—Å—Ç–Ω—ã–π –æ—Ç–∑—ã–≤</p>
            
            <div class="flex justify-center gap-2 mb-6">
                <button onclick="setRating(1)" class="rating-star text-3xl text-gray-300 hover:text-yellow-400 transition-colors">‚òÖ</button>
                <button onclick="setRating(2)" class="rating-star text-3xl text-gray-300 hover:text-yellow-400 transition-colors">‚òÖ</button>
                <button onclick="setRating(3)" class="rating-star text-3xl text-gray-300 hover:text-yellow-400 transition-colors">‚òÖ</button>
                <button onclick="setRating(4)" class="rating-star text-3xl text-gray-300 hover:text-yellow-400 transition-colors">‚òÖ</button>
                <button onclick="setRating(5)" class="rating-star text-3xl text-gray-300 hover:text-yellow-400 transition-colors">‚òÖ</button>
            </div>
            
            <input type="hidden" id="reviewOrderId" value="">
            <textarea id="reviewText" class="w-full px-4 py-3 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-black h-28 resize-none mb-4" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –æ—Ç–∑—ã–≤..."></textarea>
            
            <button onclick="submitReview()" class="w-full py-4 btn-primary rounded-xl font-semibold">
                –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∏ –ø–æ–ª—É—á–∏—Ç—å $2
            </button>
        </div>
    </div>

    <!-- Cashback History Modal -->
    <div id="cashbackModal" class="fixed bottom-0 left-0 right-0 rounded-t-3xl z-50 hidden max-h-[85vh] overflow-y-auto" style="background: var(--tg-theme-bg-color);">
        <div class="p-6">
            <div class="w-12 h-1 bg-gray-300 rounded-full mx-auto mb-4"></div>
            <h2 class="text-xl font-bold text-center mb-2">üíµ –ò—Å—Ç–æ—Ä–∏—è –∫–µ—à–±—ç–∫–∞</h2>
            <p class="text-sm text-gray-500 text-center mb-6">–ë–∞–ª–∞–Ω—Å: <span class="text-green-600 font-bold" id="cashbackModalBalance">$0.00</span></p>
            <div class="space-y-3" id="cashbackHistory"></div>
        </div>
    </div>

    <!-- Payment Modal -->
    <div id="paymentModal" class="fixed bottom-0 left-0 right-0 rounded-t-3xl z-50 hidden max-h-[90vh] overflow-y-auto" style="background: var(--tg-theme-bg-color);">
        <div class="p-6">
            <div class="w-12 h-1 bg-gray-300 rounded-full mx-auto mb-4"></div>
            <h2 class="text-xl font-bold text-center mb-2">üí≥ –û–ø–ª–∞—Ç–∞ –∑–∞–∫–∞–∑–∞</h2>
            <p class="text-sm text-gray-500 text-center mb-6">–ö –æ–ø–ª–∞—Ç–µ: <span class="text-black font-bold text-lg" id="paymentAmount">$0.00</span></p>
            
            <!-- Payment Methods Tabs -->
            <div class="flex gap-2 mb-6">
                <button onclick="selectPaymentMethod('ton')" class="payment-method-btn flex-1 py-3 rounded-xl bg-blue-500 text-white font-medium transition-all" data-method="ton">
                    üíé TON
                </button>
                <button onclick="selectPaymentMethod('usdt')" class="payment-method-btn flex-1 py-3 rounded-xl bg-gray-100 font-medium transition-all" data-method="usdt">
                    üíµ USDT TRC-20
                </button>
            </div>
            
            <!-- TON Payment -->
            <div id="tonPayment" class="space-y-4">
                <div class="card rounded-2xl p-4 bg-gradient-to-r from-blue-500 to-blue-600 text-white">
                    <p class="text-sm opacity-90 mb-1">–°—É–º–º–∞ –≤ TON (–ø—Ä–∏–º–µ—Ä–Ω–æ)</p>
                    <p class="text-3xl font-bold" id="tonAmount">~ 0 TON</p>
                    <p class="text-xs opacity-75 mt-2">–ö—É—Ä—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</p>
                </div>
                
                <button onclick="payWithTon()" class="w-full py-4 bg-blue-500 text-white rounded-xl font-semibold hover:bg-blue-600 transition-colors flex items-center justify-center gap-2">
                    <span>üíé</span> –û–ø–ª–∞—Ç–∏—Ç—å —á–µ—Ä–µ–∑ TON Connect
                </button>
                
                <p class="text-xs text-gray-400 text-center">–û—Ç–∫—Ä–æ–µ—Ç—Å—è –≤–∞—à TON-–∫–æ—à–µ–ª—ë–∫ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è</p>
            </div>
            
            <!-- USDT TRC-20 Payment -->
            <div id="usdtPayment" class="space-y-4 hidden">
                <div class="card rounded-2xl p-4 border-2 border-dashed border-gray-300">
                    <p class="text-sm text-gray-500 mb-2">–û—Ç–ø—Ä–∞–≤—å—Ç–µ USDT (TRC-20) –Ω–∞ –∞–¥—Ä–µ—Å:</p>
                    <div class="bg-gray-100 rounded-xl p-3 flex items-center gap-2">
                        <code class="text-xs flex-1 break-all font-mono" id="usdtAddress">TUgg2zUetS8JicSZNSxpTnGeA2hPGfVt9Q</code>
                        <button onclick="copyUsdtAddress()" class="p-2 hover:bg-gray-200 rounded-lg transition-colors">
                            üìã
                        </button>
                    </div>
                </div>
                
                <div class="card rounded-2xl p-4 bg-yellow-50 border border-yellow-200">
                    <div class="flex gap-2">
                        <span class="text-yellow-600">‚ö†Ô∏è</span>
                        <div class="text-sm">
                            <p class="font-medium text-yellow-800">–í–∞–∂–Ω–æ!</p>
                            <p class="text-yellow-700">–û—Ç–ø—Ä–∞–≤–ª—è–π—Ç–µ —Ç–æ–ª—å–∫–æ USDT –≤ —Å–µ—Ç–∏ TRC-20. –î—Ä—É–≥–∏–µ —Å–µ—Ç–∏ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è.</p>
                        </div>
                    </div>
                </div>
                
                <div>
                    <label class="text-sm font-medium text-gray-700 mb-2 block">–•–µ—à —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (TxID)</label>
                    <input type="text" id="txHash" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Ö–µ—à –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã..." class="w-full px-4 py-3 rounded-xl text-sm font-mono focus:outline-none focus:ring-2 focus:ring-green-500">
                    <div class="flex items-center justify-between mt-2">
                        <p class="text-xs text-gray-400">–ù–∞–π–¥–∏—Ç–µ –≤ –∏—Å—Ç–æ—Ä–∏–∏ –≤–∞—à–µ–≥–æ –∫–æ—à–µ–ª—å–∫–∞</p>
                        <button type="button" onclick="checkTronScan()" class="text-xs text-blue-600 hover:text-blue-700">
                            üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ TronScan
                        </button>
                    </div>
                </div>
                
                <button onclick="confirmUsdtPayment()" id="confirmUsdtBtn" class="w-full py-4 bg-green-600 text-white rounded-xl font-semibold hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                    ‚úì –Ø –æ–ø–ª–∞—Ç–∏–ª, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å
                </button>
            </div>
            
            <div class="mt-6 pt-4 border-t">
                <button onclick="closeModal()" class="w-full py-3 text-gray-500 text-sm">
                    –û—Ç–º–µ–Ω–∏—Ç—å
                </button>
            </div>
        </div>
    </div>

    <!-- Notifications Modal -->
    <div id="notifModal" class="fixed bottom-0 left-0 right-0 rounded-t-3xl z-50 hidden max-h-[85vh] overflow-y-auto" style="background: var(--tg-theme-bg-color);">
        <div class="p-6">
            <div class="w-12 h-1 bg-gray-300 rounded-full mx-auto mb-4"></div>
            <h2 class="text-xl font-bold text-center mb-6">üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h2>
            <div class="space-y-3" id="notificationsList"></div>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="fixed top-20 left-1/2 -translate-x-1/2 bg-black text-white px-6 py-3 rounded-full text-sm font-medium shadow-lg z-[100] hidden">
        <span id="toastMessage">–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!</span>
    </div>

    <script>
        // ==================== CONFIGURATION ====================
        const CONFIG = {
            API_URL: 'https://white-agency-app-production.up.railway.app', // Fixed: added https://
            BOT_USERNAME: 'WhiteAgency_bot',
            MANAGER_USERNAME: 'WhiteAgency_manager',
            CASHBACK_PERCENT: 5,
            REFERRAL_PERCENT: 25,
            REVIEW_BONUS: 2,
            MAX_CASHBACK_USAGE: 0.5,
            LEVELS: {
                none: { min: 0, discount: 0, next: 'bronze' },
                bronze: { min: 100, discount: 5, next: 'silver' },
                silver: { min: 500, discount: 10, next: 'gold' },
                gold: { min: 1000, discount: 15, next: 'platinum' },
                platinum: { min: 10000, discount: 20, next: null }
            },
            PRICES: [
                { name: '–°—Ç–∞—Ç–∏–∫–∞', desc: '1 –∫—Ä–µ–∞—Ç–∏–≤', price: 10 },
                { name: '–ü–∞–∫ —Å—Ç–∞—Ç–∏–∫–∏', desc: '5 –∫—Ä–µ–∞—Ç–∏–≤–æ–≤', price: 30 },
                { name: '–í–∏–¥–µ–æ-–∫—Ä–µ–∞—Ç–∏–≤', desc: '9:16 / 4:5 / 1:1', price: 25 },
                { name: '–õ–∏–ø—Å–∏–Ω–≥', desc: '–î–≤–∏–∂–µ–Ω–∏–µ –≥—É–± –ø–æ–¥ —Ç–µ–∫—Å—Ç', price: 40 },
                { name: 'AI-–∞–≤–∞—Ç–∞—Ä', desc: '–ù–µ–π—Ä–æ-–ø–µ—Ä—Å–æ–Ω–∞–∂', price: 30 },
                { name: 'UGC-–≤–∏–¥–µ–æ', desc: '–î–æ 15 —Å–µ–∫', price: 100 },
                { name: 'GIF/–ê–Ω–∏–º–∞—Ü–∏—è', desc: 'Motion-–¥–∏–∑–∞–π–Ω', price: 15 },
                { name: '–î–∏–∑–∞–π–Ω –ª–µ–Ω–¥–∏–Ω–≥–∞', desc: 'UX/UI', price: 200 }
            ]
        };

        // ==================== STATE ====================
        let state = {
            user: null,
            tgUser: null,
            isLoading: true,
            appSettings: null
        };

        // ==================== TELEGRAM WEBAPP ====================
        const tg = window.Telegram?.WebApp;

        function initTelegram() {
            if (!tg) {
                console.warn('Telegram WebApp not available');
                state.tgUser = {
                    id: 'demo_' + Date.now(),
                    first_name: 'Demo',
                    last_name: 'User',
                    username: 'demo_user'
                };
                return;
            }

            tg.ready();
            tg.expand();
            
            if (tg.colorScheme === 'dark') {
                document.body.classList.add('dark');
            }
            
            if (tg.initDataUnsafe?.user) {
                state.tgUser = tg.initDataUnsafe.user;
            }
            
            tg.BackButton.onClick(() => {
                closeModal();
            });
            
            tg.MainButton.setParams({
                text: '–ù–æ–≤—ã–π –∑–∞–∫–∞–∑',
                color: '#000000',
                text_color: '#ffffff'
            });
        }

        // ==================== API ====================
        async function apiRequest(endpoint, method = 'GET', data = null) {
            const url = CONFIG.API_URL + endpoint;
            const options = {
                method,
                headers: {
                    'Content-Type': 'application/json',
                }
            };
            
            if (tg?.initData) {
                options.headers['X-Telegram-Init-Data'] = tg.initData;
            }
            
            if (data) {
                options.body = JSON.stringify(data);
            }
            
            try {
                const response = await fetch(url, options);
                if (!response.ok) throw new Error('API Error');
                return await response.json();
            } catch (error) {
                console.error('API Error:', error);
                return null;
            }
        }

        async function loadUserData() {
            if (CONFIG.API_URL) {
                const data = await apiRequest('/api/user');
                if (data) {
                    state.user = data;
                    updateUI();
                    return;
                }
            }
            
            const saved = localStorage.getItem('whiteagency_user');
            if (saved) {
                state.user = JSON.parse(saved);
            } else {
                state.user = {
                    id: state.tgUser?.id || 'demo',
                    name: state.tgUser?.first_name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
                    username: state.tgUser?.username || '',
                    level: 'none',
                    totalSpent: 0,
                    cashback: 0,
                    referralCode: generateRefCode(),
                    referrals: [],
                    referralEarnings: 0,
                    orders: [],
                    cashbackHistory: [],
                    notifications: [],
                    trc20Wallet: '',
                    settings: {
                        notifOrders: true,
                        notifPromo: true,
                        notifRef: true
                    }
                };
                saveUserData();
            }
            updateUI();
        }

        function saveUserData() {
            localStorage.setItem('whiteagency_user', JSON.stringify(state.user));
            
            if (CONFIG.API_URL) {
                apiRequest('/api/user', 'POST', state.user);
            }
        }

        async function loadAppSettings() {
            try {
                if (CONFIG.API_URL) {
                    const settings = await apiRequest('/api/settings');
                    if (settings && settings.services) {
                        state.appSettings = settings;
                        // Update CONFIG.PRICES with server settings
                        CONFIG.PRICES = settings.services;
                        // Update service select dropdown
                        updateServiceOptions();
                        // Update prices modal
                        renderPrices();
                        console.log('App settings loaded from server');
                    }
                }
            } catch (error) {
                console.error('Failed to load app settings:', error);
                // Use default CONFIG.PRICES if API fails
            }
        }

        function updateServiceOptions() {
            const select = document.getElementById('serviceType');
            if (!select) return;

            select.innerHTML = CONFIG.PRICES.map(service =>
                `<option value="${service.price}">${service.name} (–æ—Ç $${service.price})</option>`
            ).join('');
        }

        function generateRefCode() {
            const name = state.tgUser?.first_name || 'USER';
            const rand = Math.random().toString(36).substring(2, 6).toUpperCase();
            return name.substring(0, 4).toUpperCase() + rand;
        }

        // ==================== UI UPDATES ====================
        function updateUI() {
            if (!state.user) return;
            
            const user = state.user;
            const level = CONFIG.LEVELS[user.level] || CONFIG.LEVELS.none;
            
            document.getElementById('userName').textContent = user.name;
            document.getElementById('avatarPreview').textContent = user.name[0].toUpperCase();
            document.getElementById('avatarPreview').className = `w-11 h-11 rounded-full bg-gradient-to-br from-gray-800 to-black flex items-center justify-center text-white font-bold text-lg border-2 level-${user.level || 'bronze'}`;
            
            const levelBadge = document.getElementById('userLevelBadge');
            levelBadge.textContent = user.level ? user.level.charAt(0).toUpperCase() + user.level.slice(1) : 'New';
            levelBadge.className = `text-xs px-2 py-0.5 rounded-full badge-${user.level || 'bronze'} text-white font-medium`;
            document.getElementById('userDiscount').textContent = `—Å–∫–∏–¥–∫–∞ ${level.discount}%`;
            
            document.getElementById('cashbackBalance').textContent = `$${user.cashback.toFixed(2)}`;
            
            document.getElementById('referralCount').textContent = user.referrals.length;
            document.getElementById('referralEarnings').textContent = `+$${user.referralEarnings.toFixed(2)} –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ`;
            
            updateProgressBar();
            
            document.getElementById('myPromoCode').textContent = user.referralCode;
            document.getElementById('refLinkInput').value = `t.me/${CONFIG.BOT_USERNAME}?start=${user.referralCode}`;
            
            renderOrders();
            renderStats();
            renderAchievements();
            renderPrices();
            
            document.getElementById('settingsName').value = user.name;
            document.getElementById('settingsAvatar').textContent = user.name[0].toUpperCase();
            document.getElementById('settingsUsername').textContent = user.username ? `@${user.username}` : 'Telegram';
            document.getElementById('settingsLevelBadge').textContent = user.level || 'New';
            document.getElementById('settingsLevelBadge').className = `mt-2 px-3 py-1 rounded-full badge-${user.level || 'bronze'} text-white text-xs font-medium`;
            document.getElementById('trc20Wallet').value = user.trc20Wallet || '';
            document.getElementById('notifOrders').checked = user.settings.notifOrders;
            document.getElementById('notifPromo').checked = user.settings.notifPromo;
            document.getElementById('notifRef').checked = user.settings.notifRef;
            
            const unread = user.notifications.filter(n => !n.read).length;
            document.getElementById('notifDot').style.display = unread > 0 ? 'block' : 'none';
        }

        function updateProgressBar() {
            const user = state.user;
            const currentLevel = CONFIG.LEVELS[user.level] || CONFIG.LEVELS.none;
            const nextLevelKey = currentLevel.next;
            
            if (!nextLevelKey) {
                document.getElementById('nextLevelText').textContent = '–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å!';
                document.getElementById('nextLevelDiscount').textContent = 'üéâ';
                document.getElementById('progressText').textContent = '';
                document.getElementById('progressBar').style.width = '100%';
                return;
            }
            
            const nextLevel = CONFIG.LEVELS[nextLevelKey];
            const progress = Math.min((user.totalSpent / nextLevel.min) * 100, 100);
            
            document.getElementById('nextLevelText').textContent = `–î–æ ${nextLevelKey.charAt(0).toUpperCase() + nextLevelKey.slice(1)}`;
            document.getElementById('nextLevelDiscount').textContent = `—Å–∫–∏–¥–∫–∞ ${nextLevel.discount}%`;
            document.getElementById('progressText').textContent = `$${user.totalSpent.toFixed(0)} / $${nextLevel.min}`;
            document.getElementById('progressBar').style.width = `${progress}%`;
        }

        function renderOrders() {
            try {
                const container = document.getElementById('ordersList');
                const orders = state.user.orders || [];

                if (orders.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-400">
                        <svg class="w-16 h-16 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                        </svg>
                        <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤</p>
                        <button onclick="showOrderForm()" class="mt-4 px-6 py-2 btn-primary rounded-full text-sm font-medium">
                            –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—ã–π –∑–∞–∫–∞–∑
                        </button>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = orders.slice().reverse().map(order => {
                const statusClasses = {
                    pending: 'bg-yellow-100 text-yellow-700 border-l-yellow-500',
                    pending_verification: 'bg-yellow-100 text-yellow-700 border-l-yellow-500',
                    verifying: 'bg-blue-100 text-blue-700 border-l-blue-500',
                    working: 'bg-blue-100 text-blue-700 border-l-blue-500',
                    completed: 'bg-green-100 text-green-700 border-l-green-500',
                    cancelled: 'bg-red-100 text-red-700 border-l-red-500'
                };
                const statusTexts = {
                    pending: '‚è≥ –û–∂–∏–¥–∞–µ—Ç',
                    pending_verification: '‚è≥ –ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ',
                    verifying: 'üîç –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è',
                    working: 'üé® –í —Ä–∞–±–æ—Ç–µ',
                    completed: '‚úì –ì–æ—Ç–æ–≤–æ',
                    cancelled: '‚ùå –û—Ç–º–µ–Ω—ë–Ω'
                };

                // Fallback –¥–ª—è –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö —Å—Ç–∞—Ç—É—Å–æ–≤
                const statusClass = statusClasses[order.status] || 'bg-gray-100 text-gray-700 border-l-gray-500';
                const statusText = statusTexts[order.status] || order.status;
                const borderClass = statusClass.split(' ').pop();

                // –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ formats
                let formatsText = '';
                if (Array.isArray(order.formats)) {
                    formatsText = order.formats.join(', ');
                } else if (typeof order.formats === 'string') {
                    try {
                        const parsed = JSON.parse(order.formats);
                        formatsText = Array.isArray(parsed) ? parsed.join(', ') : order.formats;
                    } catch {
                        formatsText = order.formats;
                    }
                } else {
                    formatsText = '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
                }

                return `
                    <div class="card rounded-2xl p-4 border-l-4 ${borderClass}">
                        <div class="flex justify-between items-start mb-3">
                            <div>
                                <span class="text-xs px-2 py-0.5 rounded-full ${statusClass} font-medium">${statusText}</span>
                                <h3 class="font-semibold mt-2">${order.service || '–£—Å–ª—É–≥–∞'}</h3>
                                <p class="text-xs text-gray-500">${order.niche || ''} ‚Ä¢ ${formatsText}</p>
                            </div>
                            <div class="text-right">
                                <span class="text-lg font-bold">$${(order.total || 0).toFixed(2)}</span>
                                <p class="text-xs text-green-600">+$${(order.cashbackEarned || 0).toFixed(2)} –∫–µ—à–±—ç–∫</p>
                            </div>
                        </div>
                        ${order.status === 'completed' ? `
                            <div class="flex gap-2 mt-2">
                                ${!order.reviewed ? `<button onclick="showReviewForOrder('${order.id}')" class="text-xs px-3 py-1.5 bg-gray-100 rounded-full hover:bg-gray-200">‚≠ê –û—Ç–∑—ã–≤ (+$2)</button>` : ''}
                                <button onclick="showTipsForOrder('${order.id}')" class="text-xs px-3 py-1.5 bg-green-100 text-green-700 rounded-full hover:bg-green-200">üíù –ß–∞–µ–≤—ã–µ</button>
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
            } catch (error) {
                console.error('Error rendering orders:', error);
                const container = document.getElementById('ordersList');
                if (container) {
                    container.innerHTML = `
                        <div class="text-center py-8 text-red-500">
                            <p>‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–∫–∞–∑–æ–≤</p>
                            <button onclick="location.reload()" class="mt-4 px-6 py-2 bg-black text-white rounded-full text-sm">
                                –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
                            </button>
                        </div>
                    `;
                }
            }
        }

        function renderStats() {
            const user = state.user;
            const level = CONFIG.LEVELS[user.level] || CONFIG.LEVELS.none;
            const saved = user.totalSpent * (level.discount / 100);
            
            document.getElementById('statsContent').innerHTML = `
                <div class="flex justify-between items-center">
                    <span class="text-gray-600">–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤</span>
                    <span class="font-bold">${user.orders.length}</span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-gray-600">–ü–æ—Ç—Ä–∞—á–µ–Ω–æ</span>
                    <span class="font-bold">$${user.totalSpent.toFixed(2)}</span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-gray-600">–°—ç–∫–æ–Ω–æ–º–ª–µ–Ω–æ (—Å–∫–∏–¥–∫–∏)</span>
                    <span class="font-bold text-green-600">$${saved.toFixed(2)}</span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-gray-600">–ö–µ—à–±—ç–∫ –ø–æ–ª—É—á–µ–Ω–æ</span>
                    <span class="font-bold text-green-600">$${user.cashbackHistory.filter(h => h.amount > 0).reduce((a, b) => a + b.amount, 0).toFixed(2)}</span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-gray-600">–ó–∞—Ä–∞–±–æ—Ç–æ–∫ —Å —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤</span>
                    <span class="font-bold text-green-600">$${user.referralEarnings.toFixed(2)}</span>
                </div>
            `;
        }

        function renderAchievements() {
            const user = state.user;
            const achievements = [
                { id: 'first', icon: 'üéØ', name: '–ü–µ—Ä–≤—ã–π –∑–∞–∫–∞–∑', desc: '1 –∑–∞–∫–∞–∑', unlocked: user.orders.length >= 1 },
                { id: 'vip', icon: 'üèÜ', name: 'VIP', desc: '10+ –∑–∞–∫–∞–∑–æ–≤', unlocked: user.orders.length >= 10 },
                { id: 'reviewer', icon: '‚≠ê', name: '–û—Ç–∑—ã–≤—á–∏–≤—ã–π', desc: '5 –æ—Ç–∑—ã–≤–æ–≤', unlocked: user.orders.filter(o => o.reviewed).length >= 5 },
                { id: 'networker', icon: 'ü§ù', name: '–ù–µ—Ç–≤–æ—Ä–∫–µ—Ä', desc: '3+ —Ä–µ—Ñ–µ—Ä–∞–ª–∞', unlocked: user.referrals.length >= 3 },
                { id: 'bronze', icon: 'ü•â', name: 'Bronze', desc: '$100+ –∑–∞–∫–∞–∑–æ–≤', unlocked: user.totalSpent >= 100 },
                { id: 'silver', icon: 'ü•à', name: 'Silver', desc: '$500+ –∑–∞–∫–∞–∑–æ–≤', unlocked: user.totalSpent >= 500 },
                { id: 'gold', icon: 'ü•á', name: 'Gold', desc: '$1000+ –∑–∞–∫–∞–∑–æ–≤', unlocked: user.totalSpent >= 1000 },
                { id: 'platinum', icon: 'üíé', name: 'Platinum', desc: '$10,000+', unlocked: user.totalSpent >= 10000 },
            ];
            
            document.getElementById('achievementsList').innerHTML = achievements.map(a => `
                <div class="card rounded-2xl p-3 text-center ${!a.unlocked ? 'opacity-40' : ''}">
                    <div class="w-12 h-12 mx-auto rounded-full ${a.unlocked ? 'badge-gold' : 'bg-gray-200'} flex items-center justify-center text-2xl mb-2">${a.unlocked ? a.icon : 'üîí'}</div>
                    <p class="text-xs font-medium">${a.name}</p>
                    <p class="text-[10px] text-gray-400">${a.desc}</p>
                </div>
            `).join('');
        }

        function renderPrices() {
            const level = CONFIG.LEVELS[state.user?.level] || CONFIG.LEVELS.none;
            const discountEl = document.getElementById('priceDiscount');
            const listEl = document.getElementById('pricesList');

            if (discountEl) {
                discountEl.textContent = `-${level.discount}%`;
            }

            if (listEl) {
                listEl.innerHTML = CONFIG.PRICES.map(p => {
                    const discounted = p.price * (1 - level.discount / 100);
                    return `
                        <div class="flex justify-between items-center py-3 border-b border-gray-100">
                            <div>
                                <p class="font-medium">${p.name}</p>
                                <p class="text-xs text-gray-400">${p.desc}</p>
                            </div>
                            <div class="text-right">
                                ${level.discount > 0 ? `<p class="text-gray-400 line-through text-sm">$${p.price}</p>` : ''}
                                <p class="font-bold text-green-600">$${discounted.toFixed(2)}</p>
                            </div>
                        </div>
                    `;
                }).join('');
            }
        }

        // ==================== MODALS ====================
        function showModal(modalId) {
            document.getElementById('modalOverlay').classList.remove('hidden');
            document.getElementById(modalId).classList.remove('hidden');
            document.getElementById(modalId).classList.add('slide-up');
            if (tg) tg.BackButton.show();
        }

        function closeModal() {
            document.getElementById('modalOverlay').classList.add('hidden');
            document.querySelectorAll('[id$="Modal"]').forEach(modal => {
                modal.classList.add('hidden');
            });
            if (tg) tg.BackButton.hide();
        }

        function showOrderForm() { showModal('orderModal'); updatePrice(); }
        function showTips() { showModal('tipsModal'); }
        function showReferral() { 
            showModal('referralModal');
            document.getElementById('refCountModal').textContent = state.user.referrals.length;
            document.getElementById('refEarningsModal').textContent = `$${state.user.referralEarnings.toFixed(2)}`;
        }
        function showSettings() { showModal('settingsModal'); }
        function showGallery() { showModal('galleryModal'); }
        function showPrices() { showModal('pricesModal'); }
        function showReview() { showModal('reviewModal'); }
        function showCashbackHistory() { 
            showModal('cashbackModal');
            document.getElementById('cashbackModalBalance').textContent = `$${state.user.cashback.toFixed(2)}`;
            renderCashbackHistory();
        }
        function showNotifications() { 
            showModal('notifModal');
            renderNotifications();
            state.user.notifications.forEach(n => n.read = true);
            saveUserData();
            document.getElementById('notifDot').style.display = 'none';
        }

        function showChat() {
            if (tg) {
                tg.openTelegramLink(`https://t.me/${CONFIG.MANAGER_USERNAME}`);
            } else {
                window.open(`https://t.me/${CONFIG.MANAGER_USERNAME}`, '_blank');
            }
        }

        function showReviewForOrder(orderId) {
            document.getElementById('reviewOrderId').value = orderId;
            showModal('reviewModal');
        }

        function showTipsForOrder(orderId) {
            showModal('tipsModal');
        }

        function renderCashbackHistory() {
            const history = state.user.cashbackHistory || [];
            document.getElementById('cashbackHistory').innerHTML = history.length === 0 
                ? '<p class="text-center text-gray-400 py-4">–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞</p>'
                : history.slice().reverse().map(h => `
                    <div class="flex justify-between items-center py-3 border-b border-gray-100">
                        <div>
                            <p class="font-medium text-sm">${h.description}</p>
                            <p class="text-xs text-gray-400">${new Date(h.date).toLocaleDateString('ru-RU')}</p>
                        </div>
                        <span class="${h.amount > 0 ? 'text-green-600' : 'text-red-500'} font-medium">${h.amount > 0 ? '+' : ''}$${h.amount.toFixed(2)}</span>
                    </div>
                `).join('');
        }

        function renderNotifications() {
            const notifs = state.user.notifications || [];
            document.getElementById('notificationsList').innerHTML = notifs.length === 0 
                ? '<p class="text-center text-gray-400 py-4">–ù–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</p>'
                : notifs.slice().reverse().map(n => `
                    <div class="card rounded-xl p-4 ${n.read ? 'opacity-60' : ''}">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="font-medium text-sm">${n.title}</p>
                                <p class="text-xs text-gray-500 mt-1">${n.message}</p>
                            </div>
                            <span class="text-xs text-gray-400">${timeAgo(n.date)}</span>
                        </div>
                    </div>
                `).join('');
        }

        // ==================== TABS ====================
        function switchTab(tabName) {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('tab-active');
                btn.classList.add('bg-gray-100');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('tab-active');
            document.querySelector(`[data-tab="${tabName}"]`).classList.remove('bg-gray-100');
            
            document.querySelectorAll('#tabContent > div').forEach(tab => tab.classList.add('hidden'));
            document.getElementById(`${tabName}Tab`).classList.remove('hidden');
        }

        // ==================== ORDER FORM ====================
        let selectedFormats = [];
        let uploadedFiles = [];

        function toggleFormat(btn) {
            const format = btn.textContent;
            if (selectedFormats.includes(format)) {
                selectedFormats = selectedFormats.filter(f => f !== format);
                btn.classList.remove('bg-black', 'text-white');
                btn.classList.add('bg-gray-100');
            } else {
                selectedFormats.push(format);
                btn.classList.add('bg-black', 'text-white');
                btn.classList.remove('bg-gray-100');
            }
        }

        async function handleFileSelect(input) {
            const files = Array.from(input.files);
            const preview = document.getElementById('filePreview');
            preview.innerHTML = '';
            uploadedFiles = [];

            if (files.length === 0) return;

            showToast('üìé –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤...');

            for (const file of files) {
                // Check file size (max 10MB)
                if (file.size > 10 * 1024 * 1024) {
                    showToast(`‚ùå –§–∞–π–ª "${file.name}" —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (–º–∞–∫—Å 10MB)`);
                    continue;
                }

                try {
                    // Convert to base64
                    const base64 = await fileToBase64(file);

                    uploadedFiles.push({
                        name: file.name,
                        type: file.type,
                        size: file.size,
                        data: base64
                    });

                    // Add preview
                    const previewItem = document.createElement('div');
                    previewItem.className = 'relative bg-gray-100 rounded-lg p-2 text-center';

                    if (file.type.startsWith('image/')) {
                        previewItem.innerHTML = `
                            <img src="${base64}" class="w-full h-20 object-cover rounded mb-1">
                            <p class="text-xs truncate">${file.name}</p>
                        `;
                    } else {
                        const icon = file.type.startsWith('video/') ? 'üé•' : 'üìÑ';
                        previewItem.innerHTML = `
                            <div class="text-3xl mb-1">${icon}</div>
                            <p class="text-xs truncate">${file.name}</p>
                        `;
                    }

                    preview.appendChild(previewItem);
                } catch (error) {
                    console.error('File processing error:', error);
                    showToast(`‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ "${file.name}"`);
                }
            }

            showToast(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ —Ñ–∞–π–ª–æ–≤: ${uploadedFiles.length}`);
        }

        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        function updatePrice() {
            const basePrice = parseFloat(document.getElementById('serviceType').value);
            const level = CONFIG.LEVELS[state.user?.level] || CONFIG.LEVELS.none;
            const discount = level.discount;
            const discountAmount = basePrice * (discount / 100);
            const afterDiscount = basePrice - discountAmount;
            
            let cashbackUsed = 0;
            const useCashback = document.getElementById('useCashback').checked;
            if (useCashback && state.user) {
                const maxCashback = afterDiscount * CONFIG.MAX_CASHBACK_USAGE;
                cashbackUsed = Math.min(state.user.cashback, maxCashback);
            }
            
            const total = afterDiscount - cashbackUsed;
            const earnedCashback = total * (CONFIG.CASHBACK_PERCENT / 100);
            
            document.getElementById('orderPrice').textContent = `$${basePrice.toFixed(2)}`;
            document.getElementById('discountLevel').textContent = state.user?.level || 'New';
            document.getElementById('discountPercent').textContent = discount;
            document.getElementById('orderDiscount').textContent = `-$${discountAmount.toFixed(2)}`;
            document.getElementById('orderTotal').textContent = `$${total.toFixed(2)}`;
            document.getElementById('orderCashback').textContent = `+$${earnedCashback.toFixed(2)}`;
            
            if (useCashback && cashbackUsed > 0) {
                document.getElementById('cashbackApplied').classList.remove('hidden');
                document.getElementById('cashbackAmount').textContent = `-$${cashbackUsed.toFixed(2)}`;
            } else {
                document.getElementById('cashbackApplied').classList.add('hidden');
            }
        }

        function proceedToPayment() {
            const serviceSelect = document.getElementById('serviceType');
            const basePrice = parseFloat(serviceSelect.value);
            const level = CONFIG.LEVELS[state.user?.level] || CONFIG.LEVELS.none;
            const discountAmount = basePrice * (level.discount / 100);
            const afterDiscount = basePrice - discountAmount;
            
            let cashbackUsed = 0;
            if (document.getElementById('useCashback').checked) {
                const maxCashback = afterDiscount * CONFIG.MAX_CASHBACK_USAGE;
                cashbackUsed = Math.min(state.user.cashback, maxCashback);
            }
            
            const total = afterDiscount - cashbackUsed;
            const cashbackEarned = total * (CONFIG.CASHBACK_PERCENT / 100);
            
            const order = {
                id: 'ORD' + Date.now(),
                service: serviceSelect.options[serviceSelect.selectedIndex].text.split('(')[0].trim(),
                niche: document.getElementById('nicheType').value,
                formats: selectedFormats.length > 0 ? selectedFormats : ['–ù–µ —É–∫–∞–∑–∞–Ω–æ'],
                description: document.getElementById('orderDescription').value,
                refs: document.getElementById('orderRefs').value,
                media: uploadedFiles, // Array of uploaded files with base64 data
                basePrice,
                discount: discountAmount,
                cashbackUsed,
                total,
                cashbackEarned,
                status: 'pending',
                reviewed: false,
                createdAt: new Date().toISOString()
            };
            
            closeModal();
            setTimeout(() => {
                showPayment(total, order);
            }, 300);
        }

        function updateUserLevel() {
            const spent = state.user.totalSpent;
            let newLevel = 'none';
            
            if (spent >= 10000) newLevel = 'platinum';
            else if (spent >= 1000) newLevel = 'gold';
            else if (spent >= 500) newLevel = 'silver';
            else if (spent >= 100) newLevel = 'bronze';
            
            if (newLevel !== state.user.level && newLevel !== 'none') {
                state.user.level = newLevel;
                state.user.notifications.push({
                    title: 'üéâ –ù–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å!',
                    message: `–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –¢–µ–ø–µ—Ä—å –≤—ã ${newLevel.charAt(0).toUpperCase() + newLevel.slice(1)}. –°–∫–∏–¥–∫–∞ ${CONFIG.LEVELS[newLevel].discount}%`,
                    date: new Date().toISOString(),
                    read: false
                });
            }
        }

        // ==================== REVIEW ====================
        let currentRating = 0;

        function setRating(rating) {
            currentRating = rating;
            document.querySelectorAll('.rating-star').forEach((star, index) => {
                star.classList.toggle('text-yellow-400', index < rating);
                star.classList.toggle('text-gray-300', index >= rating);
            });
        }

        function submitReview() {
            if (currentRating === 0) {
                showToast('–ü–æ—Å—Ç–∞–≤—å—Ç–µ –æ—Ü–µ–Ω–∫—É');
                return;
            }
            
            const orderId = document.getElementById('reviewOrderId').value;
            const reviewText = document.getElementById('reviewText').value;
            
            const order = state.user.orders.find(o => o.id === orderId);
            if (order) order.reviewed = true;
            
            state.user.cashback += CONFIG.REVIEW_BONUS;
            state.user.cashbackHistory.push({
                amount: CONFIG.REVIEW_BONUS,
                description: '–ë–æ–Ω—É—Å –∑–∞ –æ—Ç–∑—ã–≤',
                date: new Date().toISOString()
            });
            
            saveUserData();
            updateUI();
            
            currentRating = 0;
            document.querySelectorAll('.rating-star').forEach(star => {
                star.classList.add('text-gray-300');
                star.classList.remove('text-yellow-400');
            });
            document.getElementById('reviewText').value = '';
            document.getElementById('reviewOrderId').value = '';
            
            closeModal();
            showToast(`‚≠ê –°–ø–∞—Å–∏–±–æ –∑–∞ –æ—Ç–∑—ã–≤! +$${CONFIG.REVIEW_BONUS} –Ω–∞ –∫–µ—à–±—ç–∫`);
            
            if (tg) tg.HapticFeedback.notificationOccurred('success');
        }

        // ==================== TIPS ====================
        let selectedTip = 0;

        function selectTip(amount) {
            selectedTip = amount;
            document.querySelectorAll('.tip-btn').forEach(btn => {
                btn.classList.remove('bg-black', 'text-white');
                btn.classList.add('bg-gray-100');
            });
            event.target.classList.add('bg-black', 'text-white');
            event.target.classList.remove('bg-gray-100');
            document.getElementById('customTip').value = '';
        }

        function sendTip() {
            const customTip = document.getElementById('customTip').value;
            const amount = customTip ? parseFloat(customTip) : selectedTip;
            
            if (amount <= 0) {
                showToast('–í—ã–±–µ—Ä–∏—Ç–µ —Å—É–º–º—É');
                return;
            }
            
            closeModal();
            showToast(`üíù –û—Ç–∫—Ä—ã—Ç–∏–µ –æ–ø–ª–∞—Ç—ã $${amount}...`);
            
            selectedTip = 0;
            document.querySelectorAll('.tip-btn').forEach(btn => {
                btn.classList.remove('bg-black', 'text-white');
                btn.classList.add('bg-gray-100');
            });
            document.getElementById('customTip').value = '';
            document.getElementById('tipMessage').value = '';
        }

        // ==================== PROMO ====================
        function applyPromo() {
            const promo = document.getElementById('promoInput').value.trim();
            if (!promo) return;
            
            showToast('‚úÖ –ü—Ä–æ–º–æ–∫–æ–¥ –ø—Ä–∏–º–µ–Ω—ë–Ω!');
            document.getElementById('promoInput').value = '';
            
            if (tg) tg.HapticFeedback.notificationOccurred('success');
        }

        function copyPromo() {
            navigator.clipboard.writeText(state.user.referralCode);
            showToast('üìã –ü—Ä–æ–º–æ–∫–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!');
            if (tg) tg.HapticFeedback.impactOccurred('light');
        }

        function copyRefLink() {
            const link = `t.me/${CONFIG.BOT_USERNAME}?start=${state.user.referralCode}`;
            navigator.clipboard.writeText(link);
            showToast('üìã –°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!');
            if (tg) tg.HapticFeedback.impactOccurred('light');
        }

        function shareRefLink() {
            const link = `t.me/${CONFIG.BOT_USERNAME}?start=${state.user.referralCode}`;
            const text = `–ö—Ä—É—Ç—ã–µ –∫—Ä–µ–∞—Ç–∏–≤—ã –¥–ª—è —Ä–µ–∫–ª–∞–º—ã! -15% –Ω–∞ –ø–µ—Ä–≤—ã–π –∑–∞–∫–∞–∑ üëâ`;
            
            if (tg) {
                tg.openTelegramLink(`https://t.me/share/url?url=${encodeURIComponent(link)}&text=${encodeURIComponent(text)}`);
            } else {
                navigator.clipboard.writeText(`${text} ${link}`);
                showToast('üìã –°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!');
            }
        }

        // ==================== SETTINGS ====================
        function saveSettings() {
            state.user.name = document.getElementById('settingsName').value;
            state.user.trc20Wallet = document.getElementById('trc20Wallet').value;
            state.user.settings.notifOrders = document.getElementById('notifOrders').checked;
            state.user.settings.notifPromo = document.getElementById('notifPromo').checked;
            state.user.settings.notifRef = document.getElementById('notifRef').checked;
            
            saveUserData();
            updateUI();
            closeModal();
            showToast('‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
            
            if (tg) tg.HapticFeedback.notificationOccurred('success');
        }

        // ==================== UTILS ====================
        function showToast(message) {
            const toast = document.getElementById('toast');
            document.getElementById('toastMessage').textContent = message;
            toast.classList.remove('hidden');
            setTimeout(() => toast.classList.add('hidden'), 2500);
        }

        function timeAgo(date) {
            const seconds = Math.floor((new Date() - new Date(date)) / 1000);
            if (seconds < 60) return '—Ç–æ–ª—å–∫–æ —á—Ç–æ';
            if (seconds < 3600) return `${Math.floor(seconds / 60)} –º–∏–Ω`;
            if (seconds < 86400) return `${Math.floor(seconds / 3600)} —á–∞—Å`;
            return `${Math.floor(seconds / 86400)} –¥–Ω`;
        }

        // ==================== INIT ====================
        async function init() {
            initTelegram();

            // Load user data and app settings in parallel
            await Promise.all([
                loadUserData(),
                loadAppSettings()
            ]);

            document.getElementById('loadingScreen').style.display = 'none';
            state.isLoading = false;
        }

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeModal();
        });

        document.getElementById('modalOverlay').addEventListener('touchmove', (e) => {
            e.preventDefault();
        }, { passive: false });

        // ==================== PAYMENT ====================
        let currentPaymentMethod = 'ton';
        let pendingOrder = null;
        const USDT_ADDRESS = 'TUgg2zUetS8JicSZNSxpTnGeA2hPGfVt9Q';
        const TON_ADDRESS = 'UQDqWKqWEE4h8D2bGNXGYjPzYfYJfCO3q_K8a_8KxvKGcxiK'; // Replace with your TON wallet

        // TON payment (simple deep link, no Connect SDK needed)
        // TON Connect SDK is unstable, using simple deep link for better stability
        
        function selectPaymentMethod(method) {
            currentPaymentMethod = method;
            document.querySelectorAll('.payment-method-btn').forEach(btn => {
                const isActive = btn.dataset.method === method;
                btn.classList.toggle('bg-blue-500', isActive && method === 'ton');
                btn.classList.toggle('bg-green-600', isActive && method === 'usdt');
                btn.classList.toggle('text-white', isActive);
                btn.classList.toggle('bg-gray-100', !isActive);
            });
            
            document.getElementById('tonPayment').classList.toggle('hidden', method !== 'ton');
            document.getElementById('usdtPayment').classList.toggle('hidden', method !== 'usdt');
        }
        
        function showPayment(amount, orderData) {
            pendingOrder = orderData;
            document.getElementById('paymentAmount').textContent = `$${amount.toFixed(2)}`;
            
            const tonRate = 2.5;
            const tonAmount = (amount / tonRate).toFixed(2);
            document.getElementById('tonAmount').textContent = `~ ${tonAmount} TON`;
            
            showModal('paymentModal');
        }
        
        function copyUsdtAddress() {
            navigator.clipboard.writeText(USDT_ADDRESS);
            showToast('üìã –ê–¥—Ä–µ—Å —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!');
            if (tg) tg.HapticFeedback.impactOccurred('light');
        }
        
        document.getElementById('txHash')?.addEventListener('input', function() {
            const btn = document.getElementById('confirmUsdtBtn');
            btn.disabled = this.value.length < 10;
        });
        
        function payWithTon() {
            // Simple TON deep link payment (stable, no SDK needed)
            const tonAmount = (pendingOrder.total / 2.5).toFixed(2);
            const url = `ton://transfer/${TON_ADDRESS}?amount=${tonAmount * 1e9}&text=Order_${pendingOrder.id}`;

            if (tg) {
                tg.openLink(url);
            } else {
                window.open(url, '_blank');
            }

            showToast('üíé –û—Ç–∫—Ä–æ–π—Ç–µ TON –∫–æ—à–µ–ª—ë–∫ –∏ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é');

            // After payment, switch to USDT input for hash
            setTimeout(() => {
                selectPaymentMethod('usdt');
                document.getElementById('txHash').placeholder = '–í—Å—Ç–∞–≤—å—Ç–µ —Ö–µ—à TON-—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏...';
                showToast('–ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –≤—Å—Ç–∞–≤—å—Ç–µ —Ö–µ—à —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏');
            }, 2000);
        }
        
        function checkTronScan() {
            const txHash = document.getElementById('txHash').value.trim();
            if (!txHash) {
                showToast('–í–≤–µ–¥–∏—Ç–µ —Ö–µ—à —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏');
                return;
            }

            const url = `https://tronscan.org/#/transaction/${txHash}`;
            if (tg) {
                tg.openLink(url);
            } else {
                window.open(url, '_blank');
            }
        }

        async function confirmUsdtPayment() {
            const txHash = document.getElementById('txHash').value.trim();
            const confirmBtn = document.getElementById('confirmUsdtBtn');

            if (!txHash) {
                showToast('‚ùå –í–≤–µ–¥–∏—Ç–µ —Ö–µ—à —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏');
                return;
            }

            if (txHash.length < 10) {
                showToast('‚ùå –°–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π —Ö–µ—à');
                return;
            }

            // Validate TRC20 hash format (64 hex characters)
            const trc20HashPattern = /^[a-fA-F0-9]{64}$/;

            if (!trc20HashPattern.test(txHash)) {
                showToast('‚ö†Ô∏è –§–æ—Ä–º–∞—Ç –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç TRC20');
                return;
            }

            // Show loading state
            confirmBtn.disabled = true;
            confirmBtn.textContent = '–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏...';
            showToast('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –Ω–∞ TronScan...');

            try {
                // Verify transaction on TronScan
                const verification = await apiRequest('/api/verify-tronscan', 'POST', {
                    txHash: txHash,
                    expectedAmount: pendingOrder.total
                });

                confirmBtn.disabled = false;
                confirmBtn.textContent = '–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –æ–ø–ª–∞—Ç—É';

                if (verification && verification.verified) {
                    // Transaction verified successfully
                    showToast('‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞!');
                    completeOrder(txHash);
                } else {
                    // Transaction not verified
                    const errorMsg = verification?.error || '–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞';
                    showToast('‚ùå ' + errorMsg);

                    // Show detailed error
                    if (confirm(errorMsg + '\n\n–û—Ç–∫—Ä—ã—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –Ω–∞ TronScan –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏?')) {
                        checkTronScan();
                    }
                }
            } catch (error) {
                console.error('Verification error:', error);
                confirmBtn.disabled = false;
                confirmBtn.textContent = '–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –æ–ø–ª–∞—Ç—É';
                showToast('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑');
            }
        }
        
        function completeOrder(txHash) {
            if (!pendingOrder) return;

            pendingOrder.txHash = txHash;
            pendingOrder.paymentMethod = currentPaymentMethod;
            pendingOrder.paymentStatus = 'pending_verification';

            // Send to server
            if (CONFIG.API_URL) {
                apiRequest('/api/orders', 'POST', pendingOrder).catch(err => {
                    console.error('Failed to send order to server:', err);
                });
            }

            state.user.orders.push(pendingOrder);
            state.user.totalSpent += pendingOrder.total;

            // Only deduct used cashback, DON'T add earned cashback yet
            state.user.cashback -= pendingOrder.cashbackUsed || 0;

            if (pendingOrder.cashbackUsed > 0) {
                state.user.cashbackHistory.push({
                    amount: -pendingOrder.cashbackUsed,
                    description: `–û–ø–ª–∞—Ç–∞ –∑–∞–∫–∞–∑–∞ #${pendingOrder.id}`,
                    date: new Date().toISOString()
                });
            }
            // Cashback will be added by admin when order is completed

            updateUserLevel();
            
            state.user.notifications.push({
                title: 'üì¶ –ó–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω',
                message: `–ó–∞–∫–∞–∑ #${pendingOrder.id} –æ–∂–∏–¥–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ–ø–ª–∞—Ç—ã`,
                date: new Date().toISOString(),
                read: false
            });
            
            saveUserData();
            updateUI();
            
            pendingOrder = null;
            document.getElementById('txHash').value = '';
            document.getElementById('confirmUsdtBtn').disabled = true;
            
            closeModal();
            showToast('‚úÖ –ó–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω! –û–∂–∏–¥–∞–π—Ç–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ–ø–ª–∞—Ç—ã');
            
            if (tg) tg.HapticFeedback.notificationOccurred('success');
        }

        init();
    </script>
</body>
</html>
