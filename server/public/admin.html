<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>White Agency - –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</title>
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { font-family: 'Inter', sans-serif; }
    .glass { background: rgba(255,255,255,0.03); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.08); }
    .status-pending { background: #525252; color: #fff; }
    .status-working { background: #a3a3a3; color: #000; }
    .status-completed { background: #ffffff; color: #000; }
    .status-cancelled { background: #374151; color: #9ca3af; }
    .tab-active { background: #ffffff; color: #000; }
    .notification-badge { animation: pulse 2s infinite; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    .order-card:hover { transform: translateY(-2px); box-shadow: 0 10px 40px rgba(255, 255, 255, 0.05); }
    .fade-in { animation: fadeIn 0.3s ease-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .btn-primary { background: #ffffff; color: #000; }
    .btn-primary:hover { background: #e5e5e5; }
    .btn-secondary { background: #404040; color: #fff; }
    .btn-secondary:hover { background: #525252; }
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: #171717; }
    ::-webkit-scrollbar-thumb { background: #404040; border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: #525252; }
  </style>
</head>
<body class="bg-black text-white min-h-screen">
  <!-- Login Screen -->
  <div id="loginScreen" class="min-h-screen flex items-center justify-center p-4">
    <div class="glass rounded-2xl p-8 w-full max-w-md">
      <div class="text-center mb-8">
        <div class="text-4xl mb-4">üîê</div>
        <h1 class="text-2xl font-bold text-white">
          White Agency Admin
        </h1>
        <p class="text-gray-500 mt-2">–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞</p>
      </div>
      
      <div class="space-y-4">
        <div>
          <label class="block text-sm text-gray-400 mb-2">API URL</label>
          <input type="text" id="apiUrl" placeholder="https://your-api.railway.app" 
            class="w-full bg-neutral-900 border border-neutral-700 rounded-xl px-4 py-3 focus:outline-none focus:border-white transition">
        </div>
        <div>
          <label class="block text-sm text-gray-400 mb-2">Admin Key</label>
          <input type="password" id="adminKey" placeholder="–í–∞—à ADMIN_KEY –∏–∑ .env" 
            class="w-full bg-neutral-900 border border-neutral-700 rounded-xl px-4 py-3 focus:outline-none focus:border-white transition">
        </div>
        <button onclick="login()" 
          class="w-full btn-primary py-3 rounded-xl font-semibold transition-all">
          –í–æ–π—Ç–∏
        </button>
        <p id="loginError" class="text-red-400 text-center text-sm hidden"></p>
      </div>
    </div>
  </div>

  <!-- Main Admin Panel -->
  <div id="adminPanel" class="hidden">
    <!-- Header -->
    <header class="glass sticky top-0 z-50 border-b border-neutral-800">
      <div class="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
        <div class="flex items-center gap-3">
          <span class="text-2xl">‚ö°</span>
          <h1 class="text-xl font-bold">White Agency</h1>
          <span class="text-xs px-2 py-1 bg-white text-black rounded-full font-medium">ADMIN</span>
        </div>
        <div class="flex items-center gap-4">
          <div id="connectionStatus" class="flex items-center gap-2 text-sm">
            <span class="w-2 h-2 bg-white rounded-full"></span>
            <span class="text-gray-400">–ü–æ–¥–∫–ª—é—á–µ–Ω–æ</span>
          </div>
          <button onclick="logout()" class="text-gray-400 hover:text-white transition">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
            </svg>
          </button>
        </div>
      </div>
    </header>

    <!-- Stats Bar -->
    <div class="max-w-7xl mx-auto px-4 py-6">
      <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
        <div class="glass rounded-xl p-4">
          <div class="text-2xl mb-1">üì¶</div>
          <div class="text-2xl font-bold" id="statOrders">0</div>
          <div class="text-sm text-gray-500">–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤</div>
        </div>
        <div class="glass rounded-xl p-4">
          <div class="text-2xl mb-1">‚è≥</div>
          <div class="text-2xl font-bold text-gray-400" id="statPending">0</div>
          <div class="text-sm text-gray-500">–û–∂–∏–¥–∞—é—Ç</div>
        </div>
        <div class="glass rounded-xl p-4">
          <div class="text-2xl mb-1">üé®</div>
          <div class="text-2xl font-bold text-gray-300" id="statWorking">0</div>
          <div class="text-sm text-gray-500">–í —Ä–∞–±–æ—Ç–µ</div>
        </div>
        <div class="glass rounded-xl p-4">
          <div class="text-2xl mb-1">üë•</div>
          <div class="text-2xl font-bold text-gray-200" id="statUsers">0</div>
          <div class="text-sm text-gray-500">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
        </div>
        <div class="glass rounded-xl p-4">
          <div class="text-2xl mb-1">üí∞</div>
          <div class="text-2xl font-bold text-white" id="statRevenue">$0</div>
          <div class="text-sm text-gray-500">–î–æ—Ö–æ–¥</div>
        </div>
      </div>
    </div>

    <!-- Tabs -->
    <div class="max-w-7xl mx-auto px-4">
      <div class="flex gap-2 overflow-x-auto pb-2">
        <button onclick="switchTab('orders')" class="tab-btn tab-active px-4 py-2 rounded-lg whitespace-nowrap transition font-medium" data-tab="orders">
          üì¶ –ó–∞–∫–∞–∑—ã
        </button>
        <button onclick="switchTab('users')" class="tab-btn px-4 py-2 rounded-lg whitespace-nowrap transition bg-neutral-800 text-gray-300" data-tab="users">
          üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
        </button>
        <button onclick="switchTab('referrals')" class="tab-btn px-4 py-2 rounded-lg whitespace-nowrap transition bg-neutral-800 text-gray-300" data-tab="referrals">
          üîó –†–µ—Ñ–µ—Ä–∞–ª—ã
        </button>
        <button onclick="switchTab('notifications')" class="tab-btn px-4 py-2 rounded-lg whitespace-nowrap transition bg-neutral-800 text-gray-300" data-tab="notifications">
          üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        </button>
        <button onclick="switchTab('settings')" class="tab-btn px-4 py-2 rounded-lg whitespace-nowrap transition bg-neutral-800 text-gray-300" data-tab="settings">
          ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏
        </button>
      </div>
    </div>

    <!-- Content -->
    <main class="max-w-7xl mx-auto px-4 py-6">
      <!-- Orders Tab -->
      <div id="ordersTab" class="tab-content">
        <!-- Filters -->
        <div class="glass rounded-xl p-4 mb-6 flex flex-wrap gap-4 items-center">
          <div class="flex-1 min-w-[200px]">
            <input type="text" id="orderSearch" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ ID –∏–ª–∏ –∫–ª–∏–µ–Ω—Ç—É..." 
              class="w-full bg-neutral-900 border border-neutral-700 rounded-lg px-4 py-2 focus:outline-none focus:border-white transition"
              oninput="filterOrders()">
          </div>
          <select id="orderStatusFilter" class="bg-neutral-900 border border-neutral-700 rounded-lg px-4 py-2 focus:outline-none focus:border-white transition" onchange="filterOrders()">
            <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
            <option value="pending">‚è≥ –û–∂–∏–¥–∞–µ—Ç</option>
            <option value="working">üé® –í —Ä–∞–±–æ—Ç–µ</option>
            <option value="completed">‚úÖ –ó–∞–≤–µ—Ä—à—ë–Ω</option>
            <option value="cancelled">‚ùå –û—Ç–º–µ–Ω—ë–Ω</option>
          </select>
          <button onclick="loadOrders()" class="btn-secondary px-4 py-2 rounded-lg transition">
            üîÑ –û–±–Ω–æ–≤–∏—Ç—å
          </button>
        </div>

        <!-- Orders List -->
        <div id="ordersList" class="space-y-4">
          <div class="text-center text-gray-500 py-8">–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–∫–∞–∑–æ–≤...</div>
        </div>
      </div>

      <!-- Users Tab -->
      <div id="usersTab" class="tab-content hidden">
        <div class="glass rounded-xl p-4 mb-6 flex gap-4 items-center">
          <input type="text" id="userSearch" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ –∏–ª–∏ username..." 
            class="flex-1 bg-neutral-900 border border-neutral-700 rounded-lg px-4 py-2 focus:outline-none focus:border-white transition"
            oninput="filterUsers()">
          <button onclick="loadUsers()" class="btn-secondary px-4 py-2 rounded-lg transition">
            üîÑ –û–±–Ω–æ–≤–∏—Ç—å
          </button>
        </div>
        <div id="usersList" class="grid gap-4">
          <div class="text-center text-gray-500 py-8">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...</div>
        </div>
      </div>

      <!-- Referrals Tab -->
      <div id="referralsTab" class="tab-content hidden">
        <div class="glass rounded-xl p-4 mb-6">
          <h3 class="font-semibold mb-4">üí∏ –û–∂–∏–¥–∞—é—â–∏–µ –≤—ã–ø–ª–∞—Ç—ã</h3>
          <div id="pendingPayouts" class="space-y-3">
            <div class="text-center text-gray-500 py-4">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
          </div>
        </div>
        <div class="glass rounded-xl p-4">
          <h3 class="font-semibold mb-4">üìä –í—Å–µ —Ä–µ—Ñ–µ—Ä–∞–ª—ã</h3>
          <div id="referralsList" class="space-y-3">
            <div class="text-center text-gray-500 py-4">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
          </div>
        </div>
      </div>

      <!-- Notifications Tab -->
      <div id="notificationsTab" class="tab-content hidden">
        <div class="glass rounded-xl p-6 mb-6">
          <h3 class="font-semibold mb-4">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</h3>
          <div class="space-y-4">
            <div>
              <label class="block text-sm text-gray-400 mb-2">–ü–æ–ª—É—á–∞—Ç–µ–ª—å</label>
              <select id="notifRecipient" class="w-full bg-neutral-900 border border-neutral-700 rounded-lg px-4 py-2 focus:outline-none focus:border-white transition">
                <option value="all">üì¢ –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</option>
              </select>
            </div>
            <div>
              <label class="block text-sm text-gray-400 mb-2">–ó–∞–≥–æ–ª–æ–≤–æ–∫</label>
              <input type="text" id="notifTitle" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: üéâ –ê–∫—Ü–∏—è!" 
                class="w-full bg-neutral-900 border border-neutral-700 rounded-lg px-4 py-2 focus:outline-none focus:border-white transition">
            </div>
            <div>
              <label class="block text-sm text-gray-400 mb-2">–°–æ–æ–±—â–µ–Ω–∏–µ</label>
              <textarea id="notifMessage" rows="3" placeholder="–¢–µ–∫—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è..." 
                class="w-full bg-neutral-900 border border-neutral-700 rounded-lg px-4 py-2 focus:outline-none focus:border-white transition"></textarea>
            </div>
            <div class="flex items-center gap-4">
              <label class="flex items-center gap-2 cursor-pointer">
                <input type="checkbox" id="sendTelegram" checked class="w-4 h-4 accent-white">
                <span class="text-sm">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Telegram</span>
              </label>
            </div>
            <button onclick="sendNotification()" class="w-full btn-primary py-3 rounded-xl font-semibold transition">
              üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å
            </button>
          </div>
        </div>

        <div class="glass rounded-xl p-6">
          <h3 class="font-semibold mb-4">üìú –ò—Å—Ç–æ—Ä–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</h3>
          <div id="notificationsHistory" class="space-y-3">
            <div class="text-center text-gray-500 py-4">–ò—Å—Ç–æ—Ä–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –±—É–¥–µ—Ç –∑–¥–µ—Å—å</div>
          </div>
        </div>
      </div>

      <!-- Settings Tab -->
      <div id="settingsTab" class="tab-content hidden">
        <div class="grid md:grid-cols-2 gap-6">
          <div class="glass rounded-xl p-6">
            <h3 class="font-semibold mb-4">üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∏ API</h3>
            <div class="space-y-4">
              <div>
                <label class="block text-sm text-gray-400 mb-2">API URL</label>
                <input type="text" id="settingsApiUrl" 
                  class="w-full bg-neutral-900 border border-neutral-700 rounded-lg px-4 py-2 focus:outline-none focus:border-white transition">
              </div>
              <div>
                <label class="block text-sm text-gray-400 mb-2">Admin Key</label>
                <input type="password" id="settingsAdminKey" 
                  class="w-full bg-neutral-900 border border-neutral-700 rounded-lg px-4 py-2 focus:outline-none focus:border-white transition">
              </div>
              <button onclick="saveSettings()" class="btn-secondary px-4 py-2 rounded-lg transition">
                üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
              </button>
            </div>
          </div>

          <div class="glass rounded-xl p-6">
            <h3 class="font-semibold mb-4">üìä –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>
            <div class="space-y-3">
              <button onclick="exportOrders()" class="w-full bg-neutral-800 hover:bg-neutral-700 px-4 py-3 rounded-lg transition text-left flex items-center gap-3">
                <span>üì•</span> –≠–∫—Å–ø–æ—Ä—Ç –∑–∞–∫–∞–∑–æ–≤ –≤ CSV
              </button>
              <button onclick="exportUsers()" class="w-full bg-neutral-800 hover:bg-neutral-700 px-4 py-3 rounded-lg transition text-left flex items-center gap-3">
                <span>üì•</span> –≠–∫—Å–ø–æ—Ä—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ CSV
              </button>
              <button onclick="refreshAllData()" class="w-full bg-neutral-800 hover:bg-neutral-700 px-4 py-3 rounded-lg transition text-left flex items-center gap-3">
                <span>üîÑ</span> –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
              </button>
            </div>
          </div>

          <div class="glass rounded-xl p-6 md:col-span-2">
            <h3 class="font-semibold mb-4">üìù –î–æ–±–∞–≤–∏—Ç—å –≤ –≤–∞—à server.js</h3>
            <p class="text-gray-400 text-sm mb-4">–î–æ–±–∞–≤—å—Ç–µ —ç—Ç–∏ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –≤ –≤–∞—à –±—ç–∫–µ–Ω–¥ –¥–ª—è –ø–æ–ª–Ω–æ–π —Ä–∞–±–æ—Ç—ã –∞–¥–º–∏–Ω–∫–∏:</p>
            <pre class="bg-black rounded-lg p-4 text-xs overflow-x-auto text-gray-300 border border-neutral-800"><code>// –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∑–∞–∫–∞–∑—ã (–¥–ª—è –∞–¥–º–∏–Ω–∫–∏)
app.get('/api/admin/orders', (req, res) => {
  const adminKey = req.headers['x-admin-key'];
  if (adminKey !== process.env.ADMIN_KEY) {
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const orders = db.prepare(`
    SELECT o.*, u.name as user_name, u.username, u.telegram_id
    FROM orders o
    LEFT JOIN users u ON o.user_id = u.id
    ORDER BY o.created_at DESC
  `).all();
  
  res.json(orders);
});

// –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–¥–ª—è –∞–¥–º–∏–Ω–∫–∏)
app.get('/api/admin/users', (req, res) => {
  const adminKey = req.headers['x-admin-key'];
  if (adminKey !== process.env.ADMIN_KEY) {
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const users = db.prepare('SELECT * FROM users ORDER BY created_at DESC').all();
  res.json(users);
});

// –ü–æ–ª—É—á–∏—Ç—å —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ —Å –≤—ã–ø–ª–∞—Ç–∞–º–∏ (–¥–ª—è –∞–¥–º–∏–Ω–∫–∏)
app.get('/api/admin/referrals', (req, res) => {
  const adminKey = req.headers['x-admin-key'];
  if (adminKey !== process.env.ADMIN_KEY) {
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const referrals = db.prepare(`
    SELECT r.*, 
      u1.name as referrer_name, u1.username as referrer_username, u1.trc20_wallet,
      u2.name as referred_name, u2.username as referred_username
    FROM referrals r
    JOIN users u1 ON r.referrer_id = u1.id
    JOIN users u2 ON r.referred_id = u2.id
    ORDER BY r.created_at DESC
  `).all();
  
  res.json(referrals);
});

// –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π)
app.post('/api/admin/orders/:orderId/status', (req, res) => {
  const adminKey = req.headers['x-admin-key'];
  if (adminKey !== process.env.ADMIN_KEY) {
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const { orderId } = req.params;
  const { status } = req.body;
  
  const order = db.prepare('SELECT * FROM orders WHERE id = ?').get(orderId);
  if (!order) {
    return res.status(404).json({ error: 'Order not found' });
  }
  
  db.prepare('UPDATE orders SET status = ? WHERE id = ?').run(status, orderId);
  notifyOrderStatus(order.user_id, orderId, status);
  
  res.json({ success: true });
});

// –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
app.post('/api/admin/notify', async (req, res) => {
  const adminKey = req.headers['x-admin-key'];
  if (adminKey !== process.env.ADMIN_KEY) {
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const { userId, title, message, sendTelegram } = req.body;
  
  if (userId === 'all') {
    const users = db.prepare('SELECT * FROM users').all();
    for (const user of users) {
      db.prepare('INSERT INTO notifications (user_id, title, message) VALUES (?, ?, ?)').run(user.id, title, message);
      if (sendTelegram) {
        await bot.telegram.sendMessage(user.telegram_id, `${title}\n\n${message}`).catch(() => {});
      }
    }
  } else {
    const user = db.prepare('SELECT * FROM users WHERE id = ?').get(userId);
    if (user) {
      db.prepare('INSERT INTO notifications (user_id, title, message) VALUES (?, ?, ?)').run(userId, title, message);
      if (sendTelegram) {
        await bot.telegram.sendMessage(user.telegram_id, `${title}\n\n${message}`).catch(() => {});
      }
    }
  }
  
  res.json({ success: true });
});

// –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ –∑–∞–∫–∞–∑—É
app.post('/api/admin/orders/:orderId/message', async (req, res) => {
  const adminKey = req.headers['x-admin-key'];
  if (adminKey !== process.env.ADMIN_KEY) {
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const { orderId } = req.params;
  const { message } = req.body;
  
  const order = db.prepare(`
    SELECT o.*, u.telegram_id, u.name
    FROM orders o
    JOIN users u ON o.user_id = u.id
    WHERE o.id = ?
  `).get(orderId);
  
  if (!order) {
    return res.status(404).json({ error: 'Order not found' });
  }
  
  await bot.telegram.sendMessage(order.telegram_id, 
    `üí¨ –°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ –∑–∞–∫–∞–∑—É #${orderId}\n\n${message}`
  );
  
  db.prepare('INSERT INTO notifications (user_id, title, message) VALUES (?, ?, ?)').run(
    order.user_id, 
    `üí¨ –°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ –∑–∞–∫–∞–∑—É #${orderId}`, 
    message
  );
  
  res.json({ success: true });
});</code></pre>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Order Detail Modal -->
  <div id="orderModal" class="fixed inset-0 bg-black/90 z-50 hidden items-center justify-center p-4">
    <div class="glass rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
      <div class="sticky top-0 bg-neutral-900 p-4 border-b border-neutral-700 flex items-center justify-between">
        <h3 class="font-bold text-lg">üì¶ –î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞</h3>
        <button onclick="closeOrderModal()" class="text-gray-400 hover:text-white text-xl">‚úï</button>
      </div>
      <div id="orderModalContent" class="p-6">
        <!-- Content loaded dynamically -->
      </div>
    </div>
  </div>

  <!-- Toast Container -->
  <div id="toastContainer" class="fixed bottom-4 right-4 z-50 space-y-2"></div>

  <script>
    // State
    let apiUrl = localStorage.getItem('apiUrl') || '';
    let adminKey = localStorage.getItem('adminKey') || '';
    let ordersData = [];
    let usersData = [];
    let referralsData = [];

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      if (apiUrl && adminKey) {
        document.getElementById('apiUrl').value = apiUrl;
        document.getElementById('adminKey').value = adminKey;
        login();
      }
    });

    // Auth
    async function login() {
      const url = document.getElementById('apiUrl').value.trim().replace(/\/$/, '');
      const key = document.getElementById('adminKey').value.trim();
      
      if (!url || !key) {
        showError('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
        return;
      }
      
      apiUrl = url;
      adminKey = key;
      
      try {
        // Test connection
        const response = await fetch(`${apiUrl}/health`);
        if (!response.ok) throw new Error('Server not responding');
        
        localStorage.setItem('apiUrl', apiUrl);
        localStorage.setItem('adminKey', adminKey);
        
        document.getElementById('loginScreen').classList.add('hidden');
        document.getElementById('adminPanel').classList.remove('hidden');
        
        document.getElementById('settingsApiUrl').value = apiUrl;
        document.getElementById('settingsAdminKey').value = adminKey;
        
        refreshAllData();
      } catch (error) {
        showError('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è: ' + error.message);
      }
    }

    function logout() {
      localStorage.removeItem('apiUrl');
      localStorage.removeItem('adminKey');
      location.reload();
    }

    function showError(msg) {
      const el = document.getElementById('loginError');
      el.textContent = msg;
      el.classList.remove('hidden');
      setTimeout(() => el.classList.add('hidden'), 3000);
    }

    // API Calls
    async function apiCall(endpoint, method = 'GET', body = null) {
      const options = {
        method,
        headers: {
          'Content-Type': 'application/json',
          'X-Admin-Key': adminKey
        }
      };
      
      if (body) {
        options.body = JSON.stringify(body);
      }
      
      const response = await fetch(`${apiUrl}${endpoint}`, options);
      
      if (!response.ok) {
        throw new Error(`API Error: ${response.status}`);
      }
      
      return response.json();
    }

    // Load Data
    async function loadOrders() {
      try {
        ordersData = await apiCall('/api/admin/orders');
        renderOrders();
        updateStats();
      } catch (error) {
        console.error('Error loading orders:', error);
        document.getElementById('ordersList').innerHTML = `
          <div class="text-center text-red-400 py-8">
            ‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∑–∞–∫–∞–∑—ã<br>
            <small class="text-gray-600">–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–æ–±–∞–≤–∏–ª–∏ —ç–Ω–¥–ø–æ–∏–Ω—Ç /api/admin/orders</small>
          </div>`;
      }
    }

    async function loadUsers() {
      try {
        usersData = await apiCall('/api/admin/users');
        renderUsers();
        updateStats();
        updateNotifRecipients();
      } catch (error) {
        console.error('Error loading users:', error);
        document.getElementById('usersList').innerHTML = `
          <div class="text-center text-red-400 py-8">
            ‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π<br>
            <small class="text-gray-600">–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–æ–±–∞–≤–∏–ª–∏ —ç–Ω–¥–ø–æ–∏–Ω—Ç /api/admin/users</small>
          </div>`;
      }
    }

    async function loadReferrals() {
      try {
        referralsData = await apiCall('/api/admin/referrals');
        renderReferrals();
      } catch (error) {
        console.error('Error loading referrals:', error);
      }
    }

    async function refreshAllData() {
      showToast('üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö...', 'info');
      await Promise.all([loadOrders(), loadUsers(), loadReferrals()]);
      showToast('‚úÖ –î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã', 'success');
    }

    // Render Functions
    function renderOrders() {
      const search = document.getElementById('orderSearch').value.toLowerCase();
      const statusFilter = document.getElementById('orderStatusFilter').value;
      
      let filtered = ordersData.filter(o => {
        const matchSearch = !search || 
          o.id.toLowerCase().includes(search) ||
          (o.user_name && o.user_name.toLowerCase().includes(search)) ||
          (o.username && o.username.toLowerCase().includes(search));
        const matchStatus = !statusFilter || o.status === statusFilter;
        return matchSearch && matchStatus;
      });
      
      if (filtered.length === 0) {
        document.getElementById('ordersList').innerHTML = `
          <div class="text-center text-gray-500 py-8">–ó–∞–∫–∞–∑—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>`;
        return;
      }
      
      document.getElementById('ordersList').innerHTML = filtered.map(order => `
        <div class="order-card glass rounded-xl p-4 transition cursor-pointer fade-in" onclick="openOrderModal('${order.id}')">
          <div class="flex flex-wrap items-start justify-between gap-4">
            <div class="flex-1">
              <div class="flex items-center gap-3 mb-2">
                <span class="font-mono text-gray-300">#${order.id}</span>
                <span class="status-${order.status} px-2 py-0.5 rounded-full text-xs font-medium">
                  ${getStatusText(order.status)}
                </span>
              </div>
              <div class="text-gray-500 text-sm space-y-1">
                <div>üë§ ${order.user_name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'} ${order.username ? `(@${order.username})` : ''}</div>
                <div>üìã ${order.service} ‚Ä¢ ${order.niche}</div>
                <div>üìÖ ${formatDate(order.created_at)}</div>
              </div>
            </div>
            <div class="text-right">
              <div class="text-xl font-bold text-white">$${order.total}</div>
              <div class="text-xs text-gray-600">${order.payment_method || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</div>
            </div>
          </div>
        </div>
      `).join('');
    }

    function renderUsers() {
      const search = document.getElementById('userSearch').value.toLowerCase();
      
      let filtered = usersData.filter(u => {
        return !search || 
          (u.name && u.name.toLowerCase().includes(search)) ||
          (u.username && u.username.toLowerCase().includes(search));
      });
      
      document.getElementById('usersList').innerHTML = filtered.map(user => `
        <div class="glass rounded-xl p-4 fade-in">
          <div class="flex flex-wrap items-center justify-between gap-4">
            <div class="flex items-center gap-4">
              <div class="w-12 h-12 bg-white text-black rounded-full flex items-center justify-center text-xl font-bold">
                ${(user.name || 'U').charAt(0).toUpperCase()}
              </div>
              <div>
                <div class="font-semibold">${user.name || '–ë–µ–∑ –∏–º–µ–Ω–∏'}</div>
                <div class="text-sm text-gray-500">@${user.username || '–Ω–µ—Ç username'}</div>
                <div class="text-xs text-gray-600">ID: ${user.telegram_id}</div>
              </div>
            </div>
            <div class="flex items-center gap-6 text-sm">
              <div class="text-center">
                <div class="text-lg font-bold ${getLevelColor(user.level)}">${user.level.toUpperCase()}</div>
                <div class="text-xs text-gray-600">–£—Ä–æ–≤–µ–Ω—å</div>
              </div>
              <div class="text-center">
                <div class="text-lg font-bold text-white">$${user.total_spent || 0}</div>
                <div class="text-xs text-gray-600">–ü–æ—Ç—Ä–∞—á–µ–Ω–æ</div>
              </div>
              <div class="text-center">
                <div class="text-lg font-bold text-gray-300">$${(user.cashback || 0).toFixed(2)}</div>
                <div class="text-xs text-gray-600">–ö–µ—à–±—ç–∫</div>
              </div>
              <button onclick="sendMessageToUser(${user.id}, '${user.name}')" class="btn-secondary px-3 py-2 rounded-lg text-sm transition">
                ‚úâÔ∏è
              </button>
            </div>
          </div>
        </div>
      `).join('');
    }

    function renderReferrals() {
      // Pending payouts (earnings > 0 and not yet paid)
      const pending = referralsData.filter(r => r.earnings > 0);
      
      document.getElementById('pendingPayouts').innerHTML = pending.length > 0 ? pending.map(r => `
        <div class="bg-neutral-800 rounded-lg p-3 flex items-center justify-between">
          <div>
            <div class="font-semibold">${r.referrer_name} (@${r.referrer_username || '–Ω–µ—Ç'})</div>
            <div class="text-sm text-gray-500">–ó–∞: ${r.referred_name}</div>
            <div class="text-xs text-gray-600 mt-1">üí≥ ${r.trc20_wallet || '‚ùå –ö–æ—à–µ–ª—ë–∫ –Ω–µ —É–∫–∞–∑–∞–Ω'}</div>
          </div>
          <div class="text-right">
            <div class="text-lg font-bold text-white">$${r.earnings.toFixed(2)}</div>
            <button onclick="markAsPaid(${r.id})" class="text-xs bg-white text-black hover:bg-gray-200 px-2 py-1 rounded mt-1 font-medium">
              ‚úÖ –í—ã–ø–ª–∞—á–µ–Ω–æ
            </button>
          </div>
        </div>
      `).join('') : '<div class="text-gray-600 text-center">–ù–µ—Ç –æ–∂–∏–¥–∞—é—â–∏—Ö –≤—ã–ø–ª–∞—Ç</div>';
      
      document.getElementById('referralsList').innerHTML = referralsData.map(r => `
        <div class="bg-neutral-800 rounded-lg p-3 flex items-center justify-between">
          <div>
            <div class="text-sm">
              <span class="text-gray-300">${r.referrer_name}</span> 
              –ø—Ä–∏–≥–ª–∞—Å–∏–ª 
              <span class="text-gray-400">${r.referred_name}</span>
            </div>
            <div class="text-xs text-gray-600">${formatDate(r.created_at)}</div>
          </div>
          <div class="text-white font-semibold">+$${r.earnings.toFixed(2)}</div>
        </div>
      `).join('') || '<div class="text-gray-600 text-center">–ù–µ—Ç —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤</div>';
    }

    function updateStats() {
      document.getElementById('statOrders').textContent = ordersData.length;
      document.getElementById('statPending').textContent = ordersData.filter(o => o.status === 'pending').length;
      document.getElementById('statWorking').textContent = ordersData.filter(o => o.status === 'working').length;
      document.getElementById('statUsers').textContent = usersData.length;
      
      const revenue = ordersData
        .filter(o => o.status === 'completed')
        .reduce((sum, o) => sum + o.total, 0);
      document.getElementById('statRevenue').textContent = '$' + revenue.toFixed(0);
    }

    function updateNotifRecipients() {
      const select = document.getElementById('notifRecipient');
      select.innerHTML = '<option value="all">üì¢ –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</option>';
      usersData.forEach(u => {
        select.innerHTML += `<option value="${u.id}">üë§ ${u.name} (@${u.username || '–Ω–µ—Ç'})</option>`;
      });
    }

    // Order Modal
    function openOrderModal(orderId) {
      const order = ordersData.find(o => o.id === orderId);
      if (!order) return;
      
      document.getElementById('orderModalContent').innerHTML = `
        <div class="space-y-6">
          <div class="flex items-center justify-between">
            <span class="font-mono text-xl text-gray-300">#${order.id}</span>
            <span class="status-${order.status} px-3 py-1 rounded-full text-sm font-medium">
              ${getStatusText(order.status)}
            </span>
          </div>
          
          <div class="grid grid-cols-2 gap-4">
            <div class="bg-neutral-800 rounded-lg p-3">
              <div class="text-gray-500 text-xs mb-1">–ö–ª–∏–µ–Ω—Ç</div>
              <div class="font-semibold">${order.user_name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</div>
              <div class="text-sm text-gray-500">@${order.username || '–Ω–µ—Ç'}</div>
            </div>
            <div class="bg-neutral-800 rounded-lg p-3">
              <div class="text-gray-500 text-xs mb-1">–°—É–º–º–∞</div>
              <div class="font-semibold text-white text-xl">$${order.total}</div>
            </div>
          </div>
          
          <div class="bg-neutral-800 rounded-lg p-4 space-y-2">
            <div class="flex justify-between"><span class="text-gray-500">–£—Å–ª—É–≥–∞:</span><span>${order.service}</span></div>
            <div class="flex justify-between"><span class="text-gray-500">–ù–∏—à–∞:</span><span>${order.niche}</span></div>
            <div class="flex justify-between"><span class="text-gray-500">–§–æ—Ä–º–∞—Ç—ã:</span><span>${JSON.parse(order.formats || '[]').join(', ') || '-'}</span></div>
            <div class="flex justify-between"><span class="text-gray-500">–û–ø–ª–∞—Ç–∞:</span><span>${order.payment_method || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</span></div>
            ${order.tx_hash ? `<div class="flex justify-between"><span class="text-gray-500">TxHash:</span><span class="text-xs font-mono">${order.tx_hash.substring(0, 20)}...</span></div>` : ''}
          </div>
          
          ${order.description ? `
          <div class="bg-neutral-800 rounded-lg p-4">
            <div class="text-gray-500 text-xs mb-2">–û–ø–∏—Å–∞–Ω–∏–µ</div>
            <div class="text-sm">${order.description}</div>
          </div>` : ''}
          
          ${order.refs ? `
          <div class="bg-neutral-800 rounded-lg p-4">
            <div class="text-gray-500 text-xs mb-2">–†–µ—Ñ–µ—Ä–µ–Ω—Å—ã</div>
            <div class="text-sm break-all">${order.refs}</div>
          </div>` : ''}
          
          <div class="border-t border-neutral-700 pt-4">
            <div class="text-sm text-gray-500 mb-3">–ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å:</div>
            <div class="grid grid-cols-2 gap-2">
              <button onclick="updateOrderStatus('${order.id}', 'pending')" class="status-pending py-2 rounded-lg font-medium ${order.status === 'pending' ? 'ring-2 ring-white' : ''} hover:opacity-80 transition">
                ‚è≥ –û–∂–∏–¥–∞–µ—Ç
              </button>
              <button onclick="updateOrderStatus('${order.id}', 'working')" class="status-working py-2 rounded-lg font-medium ${order.status === 'working' ? 'ring-2 ring-white' : ''} hover:opacity-80 transition">
                üé® –í —Ä–∞–±–æ—Ç–µ
              </button>
              <button onclick="updateOrderStatus('${order.id}', 'completed')" class="status-completed py-2 rounded-lg font-medium ${order.status === 'completed' ? 'ring-2 ring-black' : ''} hover:opacity-80 transition">
                ‚úÖ –ì–æ—Ç–æ–≤
              </button>
              <button onclick="updateOrderStatus('${order.id}', 'cancelled')" class="status-cancelled py-2 rounded-lg font-medium ${order.status === 'cancelled' ? 'ring-2 ring-white' : ''} hover:opacity-80 transition">
                ‚ùå –û—Ç–º–µ–Ω—ë–Ω
              </button>
            </div>
          </div>
          
          <div class="border-t border-neutral-700 pt-4">
            <div class="text-sm text-gray-500 mb-3">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É:</div>
            <textarea id="orderMessage" rows="2" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." 
              class="w-full bg-neutral-800 border border-neutral-700 rounded-lg px-4 py-2 mb-2 focus:outline-none focus:border-white transition"></textarea>
            <button onclick="sendOrderMessage('${order.id}')" class="w-full btn-primary py-2 rounded-lg font-medium transition">
              üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å
            </button>
          </div>
        </div>
      `;
      
      document.getElementById('orderModal').classList.remove('hidden');
      document.getElementById('orderModal').classList.add('flex');
    }

    function closeOrderModal() {
      document.getElementById('orderModal').classList.add('hidden');
      document.getElementById('orderModal').classList.remove('flex');
    }

    // Actions
    async function updateOrderStatus(orderId, status) {
      try {
        await apiCall(`/api/admin/orders/${orderId}/status`, 'POST', { status });
        showToast(`‚úÖ –°—Ç–∞—Ç—É—Å –∏–∑–º–µ–Ω—ë–Ω –Ω–∞ "${getStatusText(status)}"`, 'success');
        await loadOrders();
        openOrderModal(orderId);
      } catch (error) {
        showToast('‚ùå –û—à–∏–±–∫–∞: ' + error.message, 'error');
      }
    }

    async function sendOrderMessage(orderId) {
      const message = document.getElementById('orderMessage').value.trim();
      if (!message) {
        showToast('‚ö†Ô∏è –í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ', 'warning');
        return;
      }
      
      try {
        await apiCall(`/api/admin/orders/${orderId}/message`, 'POST', { message });
        showToast('‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ', 'success');
        document.getElementById('orderMessage').value = '';
      } catch (error) {
        showToast('‚ùå –û—à–∏–±–∫–∞: ' + error.message, 'error');
      }
    }

    async function sendNotification() {
      const recipient = document.getElementById('notifRecipient').value;
      const title = document.getElementById('notifTitle').value.trim();
      const message = document.getElementById('notifMessage').value.trim();
      const sendTelegram = document.getElementById('sendTelegram').checked;
      
      if (!title || !message) {
        showToast('‚ö†Ô∏è –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Å–æ–æ–±—â–µ–Ω–∏–µ', 'warning');
        return;
      }
      
      try {
        await apiCall('/api/admin/notify', 'POST', {
          userId: recipient,
          title,
          message,
          sendTelegram
        });
        showToast('‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ', 'success');
        document.getElementById('notifTitle').value = '';
        document.getElementById('notifMessage').value = '';
      } catch (error) {
        showToast('‚ùå –û—à–∏–±–∫–∞: ' + error.message, 'error');
      }
    }

    function sendMessageToUser(userId, name) {
      switchTab('notifications');
      document.getElementById('notifRecipient').value = userId;
      document.getElementById('notifTitle').value = `üí¨ –°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è ${name}`;
      document.getElementById('notifTitle').focus();
    }

    async function markAsPaid(referralId) {
      showToast('üí∏ –§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ. –û—Ç–º–µ—Ç—å—Ç–µ –≤—ã–ø–ª–∞—Ç—É –≤—Ä—É—á–Ω—É—é.', 'info');
    }

    // Tabs
    function switchTab(tabName) {
      document.querySelectorAll('.tab-content').forEach(t => t.classList.add('hidden'));
      document.querySelectorAll('.tab-btn').forEach(b => {
        b.classList.remove('tab-active');
        b.classList.add('bg-neutral-800', 'text-gray-300');
      });
      
      document.getElementById(tabName + 'Tab').classList.remove('hidden');
      const activeBtn = document.querySelector(`[data-tab="${tabName}"]`);
      activeBtn.classList.add('tab-active');
      activeBtn.classList.remove('bg-neutral-800', 'text-gray-300');
    }

    function filterOrders() {
      renderOrders();
    }

    function filterUsers() {
      renderUsers();
    }

    // Export
    function exportOrders() {
      const csv = [
        ['ID', '–ö–ª–∏–µ–Ω—Ç', 'Username', '–£—Å–ª—É–≥–∞', '–ù–∏—à–∞', '–°—É–º–º–∞', '–°—Ç–∞—Ç—É—Å', '–û–ø–ª–∞—Ç–∞', '–î–∞—Ç–∞'].join(','),
        ...ordersData.map(o => [
          o.id,
          o.user_name || '',
          o.username || '',
          o.service,
          o.niche,
          o.total,
          o.status,
          o.payment_method || '',
          o.created_at
        ].join(','))
      ].join('\n');
      
      downloadFile('orders.csv', csv);
      showToast('üì• –ó–∞–∫–∞–∑—ã —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã', 'success');
    }

    function exportUsers() {
      const csv = [
        ['ID', 'Telegram ID', '–ò–º—è', 'Username', '–£—Ä–æ–≤–µ–Ω—å', '–ü–æ—Ç—Ä–∞—á–µ–Ω–æ', '–ö–µ—à–±—ç–∫', '–†–µ—Ñ. –∫–æ–¥', '–ö–æ—à–µ–ª—ë–∫', '–î–∞—Ç–∞'].join(','),
        ...usersData.map(u => [
          u.id,
          u.telegram_id,
          u.name || '',
          u.username || '',
          u.level,
          u.total_spent,
          u.cashback,
          u.referral_code,
          u.trc20_wallet || '',
          u.created_at
        ].join(','))
      ].join('\n');
      
      downloadFile('users.csv', csv);
      showToast('üì• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã', 'success');
    }

    function downloadFile(filename, content) {
      const blob = new Blob([content], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      a.click();
      URL.revokeObjectURL(url);
    }

    function saveSettings() {
      apiUrl = document.getElementById('settingsApiUrl').value.trim().replace(/\/$/, '');
      adminKey = document.getElementById('settingsAdminKey').value.trim();
      localStorage.setItem('apiUrl', apiUrl);
      localStorage.setItem('adminKey', adminKey);
      showToast('‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã', 'success');
    }

    // Helpers
    function getStatusText(status) {
      const statuses = {
        pending: '‚è≥ –û–∂–∏–¥–∞–µ—Ç',
        working: 'üé® –í —Ä–∞–±–æ—Ç–µ',
        completed: '‚úÖ –ì–æ—Ç–æ–≤',
        cancelled: '‚ùå –û—Ç–º–µ–Ω—ë–Ω'
      };
      return statuses[status] || status;
    }

    function getLevelColor(level) {
      const colors = {
        none: 'text-gray-600',
        bronze: 'text-gray-400',
        silver: 'text-gray-300',
        gold: 'text-gray-200',
        platinum: 'text-white'
      };
      return colors[level] || 'text-gray-500';
    }

    function formatDate(dateStr) {
      const date = new Date(dateStr);
      return date.toLocaleDateString('ru-RU', {
        day: 'numeric',
        month: 'short',
        hour: '2-digit',
        minute: '2-digit'
      });
    }

    function showToast(message, type = 'info') {
      const container = document.getElementById('toastContainer');
      const colors = {
        success: 'bg-white text-black',
        error: 'bg-red-500 text-white',
        warning: 'bg-neutral-600 text-white',
        info: 'bg-neutral-700 text-white'
      };
      
      const toast = document.createElement('div');
      toast.className = `${colors[type]} px-4 py-3 rounded-lg shadow-lg fade-in font-medium`;
      toast.textContent = message;
      container.appendChild(toast);
      
      setTimeout(() => {
        toast.remove();
      }, 3000);
    }

    // Close modal on outside click
    document.getElementById('orderModal').addEventListener('click', (e) => {
      if (e.target.id === 'orderModal') {
        closeOrderModal();
      }
    });

    // Auto-refresh every 30 seconds
    setInterval(() => {
      if (!document.getElementById('adminPanel').classList.contains('hidden')) {
        loadOrders();
      }
    }, 30000);
  </script>
</body>
</html>
